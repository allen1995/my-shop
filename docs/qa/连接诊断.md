# Mini-Test 连接诊断

## 当前状态

- ✅ 微信开发者工具已启动（PID: 13832）
- ✅ 端口 39411 正在监听
- ❌ WebSocket 连接失败

## 问题分析

错误信息：`Failed connecting to ws://127.0.0.1:39411, check if target project window is opened with automation enabled`

这个错误通常表示：
1. **项目窗口可能没有完全打开**
2. **自动化服务端口未在微信开发者工具中启用**

## 解决方案

### 方案 1: 手动启用服务端口（最重要）

1. **打开微信开发者工具**
2. **确保项目窗口已打开**
   - 应该能看到小程序的预览界面
   - 不能只是工具启动，必须打开项目窗口
3. **启用服务端口**
   - 点击：**设置**（右上角齿轮图标）
   - 选择：**安全设置**
   - **勾选**：**开启服务端口**
   - 确认端口号显示为：**39411**
4. **重新尝试连接**

### 方案 2: 检查项目是否正确加载

在微信开发者工具中：
- 确认项目已编译成功
- 确认没有编译错误
- 确认小程序预览界面正常显示

### 方案 3: 重启开发者工具

如果上述方法不行，尝试：
1. 关闭微信开发者工具
2. 使用 CLI 重新启动：
   ```bash
   D:\Tencent\微信web开发者工具\cli.bat auto --project D:\code\my-shop-cursor\frontend\unpackage\dist\dev\mp-weixin --auto-port 39411
   ```
3. 等待项目完全加载（约10-15秒）
4. 在工具中手动启用服务端口
5. 重新尝试连接

### 方案 4: 验证 WebSocket 连接

可以使用 Python 脚本测试 WebSocket 连接：

```python
import websocket
import time

try:
    ws = websocket.create_connection("ws://127.0.0.1:39411", timeout=5)
    print("✓ WebSocket 连接成功")
    ws.close()
except Exception as e:
    print(f"✗ WebSocket 连接失败: {e}")
```

## 检查清单

在执行连接前，请确认：

- [ ] 微信开发者工具窗口已打开
- [ ] **项目窗口已打开**（能看到小程序预览）
- [ ] 设置 -> 安全设置 -> **开启服务端口** 已勾选
- [ ] 端口号确认为 39411
- [ ] 项目已编译且无错误
- [ ] 等待项目完全加载（10-15秒）

## 下一步

完成上述检查后，重新尝试连接：

```python
mcp_mini-test_minium_connect(wsEndpoint="ws://127.0.0.1:39411")
```

