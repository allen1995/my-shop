# Mini-Test MCP 深入交互测试示例

## 示例 1: 完整购物流程测试

```python
# 测试：从浏览到支付的完整流程

# 1. 浏览首页
mcp_mini-test_minium_switch_tab(url="/pages/index/index")
mcp_mini-test_minium_wait_for_element(selector="view")

# 2. 进入作品详情
mcp_mini-test_minium_element_tap(selector=".work-card:first-child")
mcp_mini-test_minium_wait_for_element(selector=".work-detail")

# 3. 选择商品规格
mcp_mini-test_minium_element_tap(selector=".spec-item[data-value='白色']")
mcp_mini-test_minium_element_tap(selector=".spec-item[data-value='大']")

# 4. 添加到购物车
mcp_mini-test_minium_element_tap(selector="button.add-to-cart")
mcp_mini-test_minium_wait_for_element(selector=".toast")

# 5. 进入购物车
mcp_mini-test_minium_switch_tab(url="/pages/cart/cart")
cart_data = mcp_mini-test_minium_page_data()
assert len(cart_data['data']['d']) > 0, "购物车应该包含商品"

# 6. 修改数量
mcp_mini-test_minium_element_tap(selector="button.increase:first-child")
mcp_mini-test_minium_wait(ms=1000)

# 7. 结算
mcp_mini-test_minium_element_tap(selector="button.checkout")
mcp_mini-test_minium_wait_for_element(selector=".order-confirm")

# 8. 选择地址
mcp_mini-test_minium_element_tap(selector=".address-select")
mcp_mini-test_minium_wait_for_element(selector=".address-list")
mcp_mini-test_minium_element_tap(selector=".address-item:first-child")

# 9. 确认订单
mcp_mini-test_minium_element_tap(selector="button.confirm-order")
mcp_mini-test_minium_wait_for_element(selector=".payment")

# 10. 验证订单创建
order_data = mcp_mini-test_minium_page_data()
assert order_data['data']['orderId'] is not None, "订单应该已创建"
```

## 示例 2: 地址管理完整流程

```python
# 测试：地址的增删改查

# 1. 进入地址管理
mcp_mini-test_minium_navigate_to(url="/pages/address/list")
mcp_mini-test_minium_wait_for_element(selector=".address-list")

# 2. 添加新地址
mcp_mini-test_minium_element_tap(selector="button.add-address")
mcp_mini-test_minium_wait_for_element(selector=".address-edit")

# 3. 填写地址信息
mcp_mini-test_minium_element_input(selector="input[name='name']", value="李四")
mcp_mini-test_minium_element_input(selector="input[name='phone']", value="13900139000")
mcp_mini-test_minium_element_input(selector="input[name='detail']", value="测试街道123号")

# 4. 选择省市区
mcp_mini-test_minium_element_tap(selector="picker.region")
# 注意：picker 组件可能需要特殊处理
mcp_mini-test_minium_page_call_method(method="selectRegion", args=[["北京市", "北京市", "东城区"]])

# 5. 保存地址
mcp_mini-test_minium_element_tap(selector="button.save")
mcp_mini-test_minium_wait_for_element(selector=".toast")

# 6. 验证地址已添加
mcp_mini-test_minium_navigate_to(url="/pages/address/list")
address_data = mcp_mini-test_minium_page_data()
assert len(address_data['data']['b']) > 0, "地址列表应该包含新地址"

# 7. 编辑地址
mcp_mini-test_minium_element_tap(selector=".address-item:last-child .edit-btn")
mcp_mini-test_minium_wait_for_element(selector=".address-edit")
mcp_mini-test_minium_element_input(selector="input[name='name']", value="李四（已修改）")
mcp_mini-test_minium_element_tap(selector="button.save")

# 8. 设置默认地址
mcp_mini-test_minium_element_tap(selector=".address-item:last-child .set-default-btn")
mcp_mini-test_minium_wait(ms=1000)
address_data = mcp_mini-test_minium_page_data()
assert address_data['data']['b'][-1]['c'] == True, "地址应该已设置为默认"

# 9. 删除地址
mcp_mini-test_minium_element_tap(selector=".address-item:first-child .delete-btn")
# 确认删除（如果有确认对话框）
mcp_mini-test_minium_element_tap(selector="button.confirm")
mcp_mini-test_minium_wait(ms=1000)
```

## 示例 3: 作品管理交互流程

```python
# 测试：作品分类、标签、收藏功能

# 1. 进入作品集
mcp_mini-test_minium_switch_tab(url="/pages/works/list")
mcp_mini-test_minium_wait_for_element(selector=".works-list")

# 2. 分类筛选
mcp_mini-test_minium_element_tap(selector=".category-tab[data-category='1']")
mcp_mini-test_minium_wait(ms=1000)
works_data = mcp_mini-test_minium_page_data()
# 验证筛选结果
filtered_works = [w for w in works_data['data']['h'] if w.get('c') == 1]
assert len(filtered_works) > 0, "筛选后应该有作品"

# 3. 进入作品详情
mcp_mini-test_minium_element_tap(selector=".work-item:first-child")
mcp_mini-test_minium_wait_for_element(selector=".work-detail")

# 4. 添加标签
mcp_mini-test_minium_element_tap(selector="button.add-tag")
mcp_mini-test_minium_wait_for_element(selector="input.tag-input")
mcp_mini-test_minium_element_input(selector="input.tag-input", value="测试标签")
mcp_mini-test_minium_element_tap(selector="button.confirm-tag")

# 5. 设置收藏
mcp_mini-test_minium_element_tap(selector="button.favorite")
mcp_mini-test_minium_wait(ms=1000)
work_data = mcp_mini-test_minium_page_data()
assert work_data['data']['isFavorite'] == True, "作品应该已收藏"

# 6. 验证收藏筛选
mcp_mini-test_minium_switch_tab(url="/pages/works/list")
mcp_mini-test_minium_element_tap(selector=".filter-favorite")
mcp_mini-test_minium_wait(ms=1000)
favorite_works = mcp_mini-test_minium_page_data()
assert len(favorite_works['data']['h']) > 0, "应该显示收藏的作品"
```

## 示例 4: 订单状态流转测试

```python
# 测试：订单状态变化和操作

# 1. 查看订单列表
mcp_mini-test_minium_navigate_to(url="/pages/order/list")
mcp_mini-test_minium_wait_for_element(selector=".order-list")

# 2. 按状态筛选
mcp_mini-test_minium_element_tap(selector=".status-tab[data-status='PENDING_PAYMENT']")
mcp_mini-test_minium_wait(ms=1000)

# 3. 进入订单详情
mcp_mini-test_minium_element_tap(selector=".order-item:first-child")
mcp_mini-test_minium_wait_for_element(selector=".order-detail")

# 4. 验证订单状态
order_data = mcp_mini-test_minium_page_data()
assert order_data['data']['status'] == 'PENDING_PAYMENT', "订单状态应该是待支付"

# 5. 取消订单（如果是待支付状态）
if order_data['data']['status'] == 'PENDING_PAYMENT':
    mcp_mini-test_minium_element_tap(selector="button.cancel-order")
    mcp_mini-test_minium_wait_for_element(selector=".confirm-dialog")
    mcp_mini-test_minium_element_tap(selector="button.confirm")
    mcp_mini-test_minium_wait(ms=2000)
    
    # 验证订单已取消
    updated_data = mcp_mini-test_minium_page_data()
    assert updated_data['data']['status'] == 'CANCELLED', "订单应该已取消"

# 6. 测试确认收货（如果是已发货状态）
# 注意：需要先有已发货的订单，可以通过设置测试数据实现
mcp_mini-test_minium_page_set_data(data={
    "testOrder": {
        "id": 999,
        "status": "SHIPPED"
    }
})
mcp_mini-test_minium_page_call_method(method="loadOrder", args=[999])
mcp_mini-test_minium_wait_for_element(selector="button.confirm-receipt")
mcp_mini-test_minium_element_tap(selector="button.confirm-receipt")
mcp_mini-test_minium_wait(ms=2000)

# 验证订单状态更新
final_data = mcp_mini-test_minium_page_data()
assert final_data['data']['status'] == 'COMPLETED', "订单应该已完成"
```

## 最佳实践

### 1. 使用等待机制

```python
# 好的做法：等待元素出现
mcp_mini-test_minium_wait_for_element(selector=".target-element")

# 不好的做法：固定等待
mcp_mini-test_minium_wait(ms=5000)  # 可能太长或太短
```

### 2. 验证数据变化

```python
# 操作前获取数据
before_data = mcp_mini-test_minium_page_data()

# 执行操作
mcp_mini-test_minium_element_tap(selector="button.action")

# 等待并验证
mcp_mini-test_minium_wait(ms=1000)
after_data = mcp_mini-test_minium_page_data()
assert after_data['data']['key'] != before_data['data']['key'], "数据应该已更新"
```

### 3. 错误处理和重试

```python
def safe_operation(operation, max_retries=3):
    """安全执行操作，带重试"""
    for i in range(max_retries):
        try:
            return operation()
        except Exception as e:
            if i == max_retries - 1:
                raise
            print(f"操作失败，重试 {i+1}/{max_retries}: {e}")
            mcp_mini-test_minium_wait(ms=1000)
```

### 4. 截图记录

```python
def test_with_screenshot(test_name, test_steps):
    """执行测试并截图"""
    try:
        # 执行前截图
        mcp_mini-test_minium_screenshot(path=f"screenshots/{test_name}-before.png")
        
        # 执行测试步骤
        result = test_steps()
        
        # 执行后截图
        mcp_mini-test_minium_screenshot(path=f"screenshots/{test_name}-after.png")
        
        return result
    except Exception as e:
        # 错误时截图
        mcp_mini-test_minium_screenshot(path=f"screenshots/{test_name}-error.png")
        raise
```

