# Test Design: Story 9.1

Date: 2024-12-16
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 10
- Unit tests: 3 (30%)
- Integration tests: 5 (50%)
- E2E tests: 2 (20%)
- Priority distribution: P0: 5, P1: 4, P2: 1

## Test Scenarios by Acceptance Criteria

### AC1: 后端提供 `/api/user/profile` PUT接口

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 9.1-INT-001  | Integration | P0       | 验证PUT接口更新用户信息成功 | 接口基本功能验证 |
| 9.1-INT-002  | Integration | P0       | 验证PUT接口仅更新当前用户信息 | 安全验证，数据隔离 |
| 9.1-INT-003  | Integration | P1       | 验证PUT接口处理未授权访问 | 安全验证 |

### AC2: 支持更新昵称、头像、手机号等

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 9.1-UNIT-001 | Unit        | P0       | 验证用户信息更新参数验证逻辑（昵称长度、头像URL、手机号格式） | 输入验证逻辑 |
| 9.1-INT-004  | Integration | P0       | 验证更新昵称成功 | 字段更新验证 |
| 9.1-INT-005  | Integration | P0       | 验证更新头像URL成功 | 字段更新验证 |
| 9.1-INT-006  | Integration | P0       | 验证更新手机号成功 | 字段更新验证 |
| 9.1-INT-007  | Integration | P1       | 验证部分字段更新（只更新昵称） | 部分更新验证 |
| 9.1-E2E-001  | E2E         | P1       | 验证用户在前端更新个人信息 | 用户交互流程验证 |

### AC3: 参数验证完善

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 9.1-UNIT-002 | Unit        | P0       | 验证昵称长度限制（如1-20字符） | 参数验证逻辑 |
| 9.1-UNIT-003 | Unit        | P1       | 验证头像URL格式验证 | 参数验证逻辑 |
| 9.1-INT-008  | Integration | P1       | 验证无效参数返回友好错误信息 | 错误处理验证 |
| 9.1-E2E-002  | E2E         | P2       | 验证前端表单验证提示 | UI验证提示验证 |

### AC4: 返回更新后的用户信息

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 9.1-INT-009  | Integration | P0       | 验证PUT接口返回更新后的完整用户信息 | 接口响应验证 |

## Risk Coverage

- 安全风险：通过INT测试验证用户数据隔离和未授权访问
- 数据完整性风险：通过INT测试验证字段更新持久化
- 用户体验风险：通过E2E测试验证个人信息更新流程

## Recommended Execution Order

1. P0 Unit tests (fail fast)
   - 9.1-UNIT-001: 用户信息更新参数验证
   - 9.1-UNIT-002: 昵称长度限制验证
2. P0 Integration tests
   - 9.1-INT-001: PUT接口更新用户信息
   - 9.1-INT-002: 仅更新当前用户信息
   - 9.1-INT-004: 更新昵称
   - 9.1-INT-005: 更新头像URL
   - 9.1-INT-006: 更新手机号
   - 9.1-INT-009: 返回更新后的用户信息
3. P0 E2E tests
   - (无P0 E2E测试)
4. P1 tests in order
   - 9.1-UNIT-003: 头像URL格式验证
   - 9.1-INT-003: 未授权访问处理
   - 9.1-INT-007: 部分字段更新
   - 9.1-INT-008: 无效参数错误处理
   - 9.1-E2E-001: 前端更新个人信息
5. P2+ as time permits
   - 9.1-E2E-002: 前端表单验证提示

## Coverage Gaps

无 - 所有验收标准都有测试覆盖

