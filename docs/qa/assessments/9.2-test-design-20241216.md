# Test Design: Story 9.2

Date: 2024-12-16
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 18
- Unit tests: 4 (22%)
- Integration tests: 11 (61%)
- E2E tests: 3 (17%)
- Priority distribution: P0: 10, P1: 7, P2: 1

## Test Scenarios by Acceptance Criteria

### AC1: Address实体类已创建

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 9.2-UNIT-001 | Unit        | P1       | 验证Address实体字段完整性（收货人、手机号、省市区、详细地址等） | 实体结构验证 |
| 9.2-INT-001  | Integration | P1       | 验证Address实体持久化到数据库 | 数据库操作验证 |

### AC2: 地址CRUD API已实现

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 9.2-UNIT-002 | Unit        | P0       | 验证地址创建参数验证逻辑（收货人、手机号、地址等） | 输入验证逻辑 |
| 9.2-INT-002  | Integration | P0       | 验证POST接口创建地址成功 | 创建功能验证 |
| 9.2-INT-003  | Integration | P0       | 验证GET接口查询地址列表成功 | 查询功能验证 |
| 9.2-INT-004  | Integration | P0       | 验证GET接口查询地址详情成功 | 查询功能验证 |
| 9.2-INT-005  | Integration | P0       | 验证PUT接口更新地址成功 | 更新功能验证 |
| 9.2-INT-006  | Integration | P0       | 验证DELETE接口删除地址成功 | 删除功能验证 |
| 9.2-INT-007  | Integration | P0       | 验证地址CRUD操作仅操作当前用户地址 | 安全验证，数据隔离 |
| 9.2-INT-008  | Integration | P1       | 验证GET接口仅返回当前用户地址列表 | 安全验证 |
| 9.2-INT-009  | Integration | P1       | 验证删除不存在的地址返回友好错误 | 错误处理验证 |
| 9.2-INT-010  | Integration | P1       | 验证更新不存在的地址返回友好错误 | 错误处理验证 |
| 9.2-E2E-001  | E2E         | P1       | 验证用户在前端完成地址CRUD操作 | 用户交互流程验证 |

### AC3: 支持设置默认地址

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 9.2-UNIT-003 | Unit        | P0       | 验证设置默认地址业务逻辑（清除其他默认地址） | 业务逻辑验证 |
| 9.2-INT-011  | Integration | P0       | 验证PUT接口设置默认地址成功 | 功能验证 |
| 9.2-INT-012  | Integration | P0       | 验证设置新默认地址时自动清除其他默认地址 | 业务规则验证 |
| 9.2-INT-013  | Integration | P1       | 验证创建地址时设置默认地址 | 功能验证 |
| 9.2-E2E-002  | E2E         | P1       | 验证用户在前端设置默认地址 | 用户交互验证 |

### AC4: 地址验证完善

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 9.2-UNIT-004 | Unit        | P0       | 验证地址字段验证逻辑（收货人姓名、手机号格式、省市区、详细地址） | 输入验证逻辑 |
| 9.2-INT-014  | Integration | P1       | 验证无效地址参数返回友好错误信息 | 错误处理验证 |
| 9.2-E2E-003  | E2E         | P2       | 验证前端地址表单验证提示 | UI验证提示验证 |

## Risk Coverage

- 安全风险：通过INT测试验证用户数据隔离
- 数据完整性风险：通过INT测试验证地址CRUD操作和默认地址逻辑
- 业务规则风险：通过INT测试验证默认地址唯一性规则

## Recommended Execution Order

1. P0 Unit tests (fail fast)
   - 9.2-UNIT-002: 地址创建参数验证
   - 9.2-UNIT-003: 设置默认地址业务逻辑
   - 9.2-UNIT-004: 地址字段验证逻辑
2. P0 Integration tests
   - 9.2-INT-002: POST接口创建地址
   - 9.2-INT-003: GET接口查询地址列表
   - 9.2-INT-004: GET接口查询地址详情
   - 9.2-INT-005: PUT接口更新地址
   - 9.2-INT-006: DELETE接口删除地址
   - 9.2-INT-007: 仅操作当前用户地址
   - 9.2-INT-011: PUT接口设置默认地址
   - 9.2-INT-012: 自动清除其他默认地址
3. P0 E2E tests
   - (无P0 E2E测试)
4. P1 tests in order
   - 9.2-UNIT-001: Address实体字段验证
   - 9.2-INT-001: Address实体持久化
   - 9.2-INT-008: 仅返回当前用户地址列表
   - 9.2-INT-009: 删除不存在地址错误处理
   - 9.2-INT-010: 更新不存在地址错误处理
   - 9.2-INT-013: 创建地址时设置默认地址
   - 9.2-INT-014: 无效地址参数错误处理
   - 9.2-E2E-001: 前端地址CRUD操作
   - 9.2-E2E-002: 前端设置默认地址
5. P2+ as time permits
   - 9.2-E2E-003: 前端地址表单验证提示

## Coverage Gaps

无 - 所有验收标准都有测试覆盖

