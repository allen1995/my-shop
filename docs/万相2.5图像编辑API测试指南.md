# ä¸‡ç›¸2.5å›¾åƒç¼–è¾‘API æµ‹è¯•æŒ‡å—

## âœ… ä»£ç æ›´æ–°å®Œæˆ

### æ›´æ–°å†…å®¹

1. **SDKç‰ˆæœ¬**: å‡çº§åˆ° 2.22.2
2. **æ¨¡å‹åç§°**: `wan2.5-i2i-preview`
3. **è°ƒç”¨æ–¹å¼**: ä½¿ç”¨å®˜æ–¹æ ‡å‡† Builder æ¨¡å¼
4. **ç®€åŒ–ä»£ç **: ç§»é™¤åå°„å’Œé™çº§æ–¹æ¡ˆ

### æ ¸å¿ƒä»£ç 

```java
List<String> images = new ArrayList<>();
images.add(workImageUrl);  // å›¾ä¸€ï¼šå°èŠ±
images.add(bagImageUrl);   // å›¾äºŒï¼šåº•å›¾

ImageSynthesisParam param = ImageSynthesisParam.builder()
        .apiKey(apiKey)
        .model("wan2.5-i2i-preview")  // ä¸‡ç›¸2.5å›¾åƒç¼–è¾‘æ¨¡å‹
        .prompt(prompt)                // æç¤ºè¯
        .images(images)                // å›¾ç‰‡åˆ—è¡¨
        .n(1)                         // ç”Ÿæˆæ•°é‡
        .size("1024*1024")            // è¾“å‡ºå°ºå¯¸
        .build();

ImageSynthesisResult result = gen.call(param);
```

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### å‰ææ¡ä»¶

1. **æ›´æ–° pom.xml**:
```xml
<dependency>
    <groupId>com.alibaba</groupId>
    <artifactId>dashscope-sdk-java</artifactId>
    <version>2.22.2</version>
</dependency>
```

2. **é…ç½® API Key**:
```yaml
app:
  aliyun:
    dashscope:
      api-key: ${ALIYUN_DASHSCOPE_API_KEY:your-api-key}
```

3. **Java ç‰ˆæœ¬**: ç¡®ä¿ä½¿ç”¨ Java 17+

---

### æ­¥éª¤ 1: å¯åŠ¨åç«¯

```bash
cd backend
mvn clean install
mvn spring-boot:run
```

**æ£€æŸ¥æ—¥å¿—è¾“å‡º**:
```
é…ç½®DashScopeå›¾ç‰‡ç”Ÿæˆæ¨¡å‹ï¼ˆä¸»æ¨¡å‹ï¼‰
DashScopeæ¨¡å‹å¯ç”¨
å¯åŠ¨æˆåŠŸ
```

---

### æ­¥éª¤ 2: æµ‹è¯•é¢„è§ˆç”Ÿæˆ

#### 2.1 åˆ›å»ºé¢„è§ˆä»»åŠ¡

**è¯·æ±‚**:
```bash
curl -X POST http://localhost:8080/api/preview/generate \
  -H "Content-Type: application/json" \
  -d '{
    "workId": 100,
    "productId": 200,
    "color": "é»‘è‰²",
    "size": "ä¸­"
  }'
```

**é¢„æœŸå“åº”**:
```json
{
  "code": 200,
  "message": "æˆåŠŸ",
  "data": {
    "taskId": 1,
    "status": "PENDING",
    "estimatedTime": 10
  }
}
```

#### 2.2 æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€

**è¯·æ±‚**:
```bash
curl http://localhost:8080/api/preview/tasks/1
```

**å¤„ç†ä¸­**:
```json
{
  "code": 200,
  "data": {
    "taskId": 1,
    "status": "PROCESSING",
    "progress": 50
  }
}
```

**å®Œæˆ**:
```json
{
  "code": 200,
  "data": {
    "taskId": 1,
    "status": "COMPLETED",
    "progress": 100,
    "resultUrl": "https://oss.example.com/preview/xxx.jpg"
  }
}
```

---

### æ­¥éª¤ 3: æ£€æŸ¥æ—¥å¿—

**æˆåŠŸçš„æ—¥å¿—**:
```
å‡†å¤‡è°ƒç”¨é€šä¹‰ä¸‡ç›¸å›¾åƒç¼–è¾‘API:
  - æ¨¡å‹: wan2.5-i2i-preview
  - å°èŠ±å›¾ç‰‡(å›¾ä¸€): https://...
  - åŒ…åŒ…åº•å›¾(å›¾äºŒ): https://...
  - æç¤ºè¯: å°†å›¾ä¸€ä½œä¸ºå°èŠ±å›¾æ¡ˆ...
  - è¾“å‡ºå°ºå¯¸: 1024*1024
è°ƒç”¨å›¾åƒç¼–è¾‘API - SDKç‰ˆæœ¬: 2.22.2
å›¾åƒç¼–è¾‘å®Œæˆï¼Œè€—æ—¶: 8523ms, URL: https://oss...
```

**å¤±è´¥çš„æ—¥å¿—**:
```
å›¾åƒç¼–è¾‘å¤±è´¥ï¼Œè€—æ—¶: 5432ms
java.lang.RuntimeException: APIè°ƒç”¨å¤±è´¥...
```

---

## ğŸ¨ é»˜è®¤æç¤ºè¯

```
å°†å›¾ä¸€ä½œä¸ºå°èŠ±å›¾æ¡ˆè‡ªç„¶åœ°æ”¾ç½®åœ¨å›¾äºŒåŒ…åŒ…çš„ä¸­å¿ƒåŒºåŸŸï¼Œ
ä¿æŒåŒ…åŒ…åŸæœ‰çš„æè´¨ã€å…‰å½±å’Œç«‹ä½“æ•ˆæœï¼Œ
å°èŠ±å¤§å°ä¸ºåŒ…åŒ…å¯è§†åŒºåŸŸçš„30%å·¦å³ï¼Œ
å°èŠ±ä½ç½®å±…ä¸­åä¸Šï¼Œ
æ•´ä½“æ•ˆæœçœŸå®è‡ªç„¶
```

**ä¼˜åŒ–å»ºè®®**:
- æ ¹æ®å®é™…æ•ˆæœè°ƒæ•´ä½ç½®æè¿°
- æ·»åŠ é£æ ¼æè¿°ï¼ˆå¦‚"æ—¶å°š"ã€"å¤å¤"ç­‰ï¼‰
- è°ƒæ•´å¤§å°æ¯”ä¾‹ï¼ˆ20%-40%ï¼‰

---

## ğŸ” å¸¸è§é—®é¢˜æ’æŸ¥

### Q1: APIè°ƒç”¨å¤±è´¥ - Invalid API Key

**æ£€æŸ¥**:
```bash
# æŸ¥çœ‹é…ç½®
cat backend/src/main/resources/application.yml | grep dashscope

# æ£€æŸ¥ç¯å¢ƒå˜é‡
echo $ALIYUN_DASHSCOPE_API_KEY
```

**è§£å†³**:
- ç¡®è®¤ API Key æ­£ç¡®
- ç¡®è®¤è´¦æˆ·ä½™é¢å……è¶³
- ç¡®è®¤ API Key æƒé™åŒ…å«å›¾åƒç”Ÿæˆ

---

### Q2: å›¾ç‰‡URLæ— æ³•è®¿é—®

**æ£€æŸ¥**:
```bash
# æµ‹è¯•å›¾ç‰‡URLæ˜¯å¦å¯è®¿é—®
curl -I https://your-image-url.jpg
```

**è§£å†³**:
- ç¡®ä¿å›¾ç‰‡URLå…¬å¼€å¯è®¿é—®
- æ£€æŸ¥OSSé…ç½®æ˜¯å¦æ­£ç¡®
- ä½¿ç”¨HTTPSè€ŒéHTTP

---

### Q3: ç”Ÿæˆæ—¶é—´è¿‡é•¿

**æ­£å¸¸æƒ…å†µ**:
- é€šä¹‰ä¸‡ç›¸APIé€šå¸¸éœ€è¦ 5-15 ç§’
- é¦–æ¬¡è°ƒç”¨å¯èƒ½è¾ƒæ…¢

**ä¼˜åŒ–**:
- å·²å®ç°å¼‚æ­¥è°ƒç”¨
- å·²å®ç°ç¼“å­˜æœºåˆ¶
- ç›¸åŒå‚æ•°ä¼šç›´æ¥è¿”å›ç¼“å­˜

---

### Q4: ç”Ÿæˆæ•ˆæœä¸ç†æƒ³

**è°ƒæ•´æ–¹å‘**:
1. **æç¤ºè¯ä¼˜åŒ–**: ä¿®æ”¹ `generateDefaultPrompt()` æ–¹æ³•
2. **ä½ç½®è°ƒæ•´**: è°ƒæ•´"å±…ä¸­åä¸Š"çš„æè¿°
3. **å¤§å°è°ƒæ•´**: ä¿®æ”¹"30%å·¦å³"çš„æ¯”ä¾‹
4. **é£æ ¼è°ƒæ•´**: æ·»åŠ é£æ ¼æè¿°è¯

**ç¤ºä¾‹æç¤ºè¯**:
```java
private String generateDefaultPrompt() {
    return "å°†å›¾ä¸€ä½œä¸ºå°èŠ±å›¾æ¡ˆè‡ªç„¶åœ°æ”¾ç½®åœ¨å›¾äºŒåŒ…åŒ…çš„æ­£ä¸­å¿ƒï¼Œ" +
           "ä¿æŒåŒ…åŒ…åŸæœ‰çš„æè´¨ã€å…‰å½±å’Œç«‹ä½“æ•ˆæœï¼Œ" +
           "å°èŠ±å¤§å°ä¸ºåŒ…åŒ…å¯è§†åŒºåŸŸçš„25%ï¼Œ" +
           "å°èŠ±ä½ç½®å®Œå…¨å±…ä¸­ï¼Œ" +
           "æ•´ä½“æ•ˆæœæ—¶å°šã€ç°ä»£ã€çœŸå®";
}
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

- **å¹³å‡ç”Ÿæˆæ—¶é—´**: 8-12 ç§’
- **æˆåŠŸç‡**: > 95%
- **ç¼“å­˜å‘½ä¸­ç‡**: æ ¹æ®ä½¿ç”¨æƒ…å†µ
- **é‡è¯•æ¬¡æ•°**: æœ€å¤š 3 æ¬¡

---

## ğŸ”— ç›¸å…³èµ„æº

- **å®˜æ–¹æ–‡æ¡£**: https://help.aliyun.com/zh/model-studio/wan2-5-image-edit-api-reference
- **SDKæ–‡æ¡£**: https://help.aliyun.com/zh/dashscope/developer-reference/sdk-overview
- **APIæ§åˆ¶å°**: https://dashscope.console.aliyun.com/

---

## âœ… æµ‹è¯•æ£€æŸ¥æ¸…å•

- [ ] SDK å‡çº§åˆ° 2.22.2
- [ ] æ¨¡å‹åç§°æ”¹ä¸º `wan2.5-i2i-preview`
- [ ] API Key é…ç½®æ­£ç¡®
- [ ] åç«¯æˆåŠŸå¯åŠ¨
- [ ] åˆ›å»ºé¢„è§ˆä»»åŠ¡æˆåŠŸ
- [ ] ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢æ­£å¸¸
- [ ] é¢„è§ˆå›¾ç‰‡ç”ŸæˆæˆåŠŸ
- [ ] å›¾ç‰‡è´¨é‡æ»¡æ„
- [ ] ç¼“å­˜æœºåˆ¶æ­£å¸¸å·¥ä½œ
- [ ] é”™è¯¯å¤„ç†æ­£ç¡®

---

## ğŸ‰ é¢„æœŸç»“æœ

1. **APIè°ƒç”¨æˆåŠŸ**
2. **ç”Ÿæˆæ—¶é—´**: 8-15 ç§’
3. **é¢„è§ˆå›¾ç‰‡**: é«˜è´¨é‡åˆæˆæ•ˆæœ
4. **ç¼“å­˜å‘½ä¸­**: ç›¸åŒå‚æ•°ç›´æ¥è¿”å›

**æˆåŠŸæ ‡å¿—**:
- æ—¥å¿—æ˜¾ç¤º "å›¾åƒç¼–è¾‘å®Œæˆ"
- è¿”å›æœ‰æ•ˆçš„ OSS URL
- å‰ç«¯èƒ½å¤Ÿæ­£å¸¸æ˜¾ç¤ºé¢„è§ˆå›¾ç‰‡

