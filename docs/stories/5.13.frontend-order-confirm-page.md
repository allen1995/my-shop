# Story 5.13: 前端订单确认页面

## Status

Draft

## Story

**As a** user,
**I want** to confirm my order details before payment,
**so that** I can verify everything is correct.

## Acceptance Criteria

1. 订单确认页面已创建
2. 显示订单商品列表
3. 显示收货地址选择（如果已设置）
4. 显示订单总价
5. "提交订单"按钮已实现
6. 页面UI美观，符合设计规范

## Tasks / Subtasks

- [ ] Task 1: 创建订单确认页面 (AC: 1, 6)
  - [ ] 创建pages/order/confirm.vue页面
  - [ ] 配置页面路由
  - [ ] 设计页面布局和样式
- [ ] Task 2: 实现订单商品列表显示 (AC: 2)
  - [ ] 接收购物车项ID参数
  - [ ] 调用cartApi.getCartItems获取购物车项详情
  - [ ] 显示订单商品列表
  - [ ] 显示作品预览图、商品信息、规格、数量、价格
- [ ] Task 3: 实现收货地址选择 (AC: 3)
  - [ ] 调用addressApi.getAddresses获取地址列表
  - [ ] 显示地址列表
  - [ ] 支持选择默认地址
  - [ ] 支持跳转到地址管理页面
  - [ ] 如果没有地址，提示添加地址
- [ ] Task 4: 实现订单总价显示 (AC: 4)
  - [ ] 计算订单总价
  - [ ] 显示订单总价
- [ ] Task 5: 实现提交订单功能 (AC: 5)
  - [ ] 实现"提交订单"按钮
  - [ ] 验证地址已选择
  - [ ] 调用orderApi.createOrder创建订单
  - [ ] 跳转到支付页面
  - [ ] 传递订单ID
  - [ ] 添加加载状态和错误处理

## Dev Notes

### Previous Story Insights

依赖Story 5.7（创建订单API）、Story 9.2（地址实体API）完成，确保相关API已实现。

### Data Models

使用后端返回的数据：
- CartItem: { id, workId, productId, color, size, quantity, price, previewImageUrl }
- Address: { id, receiverName, receiverPhone, province, city, district, detail, isDefault }

[Source: docs/fullstack-architecture.md#Order（订单）]

### API Specifications

使用以下API：
- GET /api/cart/items - 获取购物车项详情（用于订单确认）
- GET /api/addresses - 获取地址列表
- POST /api/orders - 创建订单

[Source: docs/fullstack-architecture.md#API Specification]

### File Locations

**前端文件位置：**
```
frontend/
├── pages/
│   └── order/
│       └── confirm.vue               # 订单确认页面
└── api/
    ├── cart.js                       # 购物车API（已存在）
    ├── address.js                   # 地址API（已存在）
    └── order.js                     # 订单API（已存在）
```

[Source: docs/fullstack-architecture.md#Frontend Structure]

### Technical Constraints

- **框架**: uni-app (Vue 3 Composition API)
- **参数传递**: 通过URL参数传递购物车项ID
- **地址选择**: 必须选择地址才能提交订单
- **UI组件**: 使用uni-app组件

[Source: docs/fullstack-architecture.md#Tech Stack]

### Testing Requirements

- 手动测试订单确认页面功能
- 测试地址选择
- 测试提交订单
- 测试跳转到支付页面

[Source: docs/fullstack-architecture.md#Tech Stack]

## Testing

### Test File Location

由于是前端页面，主要进行手动测试。

### Test Standards

- 在微信开发者工具中测试
- 测试各种交互场景
- 验证UI显示正确

### Test Scenarios

1. **订单商品列表显示测试**
   - 从购物车跳转到订单确认页面
   - 验证订单商品列表正确显示
   - 验证商品信息、规格、数量、价格正确

2. **收货地址选择测试**
   - 验证地址列表正确显示
   - 选择地址
   - 验证默认地址正确显示
   - 测试跳转到地址管理页面

3. **订单总价显示测试**
   - 验证订单总价正确计算
   - 验证总价显示正确

4. **提交订单测试**
   - 选择地址
   - 点击"提交订单"按钮
   - 验证订单创建成功
   - 验证跳转到支付页面
   - 验证订单ID正确传递

5. **地址验证测试**
   - 不选择地址
   - 点击"提交订单"按钮
   - 验证提示选择地址

### Success Criteria

- 订单确认页面能够正常显示
- 所有功能正常工作
- UI美观，符合设计规范
- 用户体验良好

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-15 | 1.0 | 初始故事创建 | Scrum Master |

## Dev Agent Record

### Agent Model Used

_To be filled by Dev Agent_

### Debug Log References

_To be filled by Dev Agent_

### Completion Notes List

_To be filled by Dev Agent_

### File List

_To be filled by Dev Agent_

## QA Results

_To be filled by QA Agent_

