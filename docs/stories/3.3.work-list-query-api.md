# Story 3.3: 作品列表查询API

## Status

Draft

## Story

**As a** user,
**I want** to view my collection of works,
**so that** I can browse and manage my created artworks.

## Acceptance Criteria

1. 后端提供 `/api/works` GET接口
2. 接口支持分页查询（page、size参数）
3. 返回当前用户的作品列表
4. 列表按创建时间倒序排列
5. 接口响应时间小于100ms
6. 支持按标题搜索（可选）

## Tasks / Subtasks

- [ ] Task 1: 实现作品列表查询接口 (AC: 1, 2, 3, 4)
  - [ ] 在WorkController中实现GET /api/works接口
  - [ ] 接收分页参数（page、size，默认值）
  - [ ] 从UserContext获取当前用户ID
  - [ ] 调用Repository查询当前用户的作品
  - [ ] 按创建时间倒序排列
  - [ ] 返回分页结果
- [ ] Task 2: 实现分页响应 (AC: 2, 3)
  - [ ] 创建分页响应DTO（包含works列表和total总数）
  - [ ] 使用Spring Data的Pageable和Page
  - [ ] 返回分页信息
- [ ] Task 3: 实现按标题搜索（可选）(AC: 6)
  - [ ] 添加title查询参数（可选）
  - [ ] 在Repository中添加findByUserIdAndTitleContaining方法
  - [ ] 如果title参数存在，使用搜索查询
- [ ] Task 4: 优化查询性能 (AC: 5)
  - [ ] 确保Repository查询使用索引
  - [ ] 避免N+1查询问题
  - [ ] 验证响应时间小于100ms
- [ ] Task 5: 创建单元测试 (AC: 1, 2, 3, 4)
  - [ ] 创建WorkControllerTest（更新）
  - [ ] 测试查询作品列表
  - [ ] 测试分页功能
  - [ ] 测试按标题搜索（如果实现）
  - [ ] 测试只返回当前用户的作品

## Dev Notes

### Previous Story Insights

依赖Story 3.1（作品实体和数据库设计）和Story 1.6（JWT认证中间件）完成，确保Work实体类和UserContext已创建。

### Data Models

使用Story 3.1创建的Work实体类。

**分页响应DTO：**
- WorkListResponse: { works: Work[], total: number, page: number, size: number }

[Source: docs/fullstack-architecture.md#Work（作品）]

### API Specifications

**GET /api/works**
- 描述：获取作品列表
- 认证：需要JWT Token
- 查询参数：`page?: number, size?: number, title?: string`
- 响应：`{ works: Work[], total: number }`

**分页参数：**
- page: 页码，从0开始，默认0
- size: 每页数量，默认10

[Source: docs/fullstack-architecture.md#API Specification]

### File Locations

**后端文件位置：**
```
backend/src/main/java/com/myshop/
├── controller/
│   └── WorkController.java          # 作品控制器（更新）
├── repository/
│   └── WorkRepository.java         # 作品数据访问接口（更新）
└── dto/
    └── WorkListResponse.java        # 作品列表响应DTO
```

[Source: docs/fullstack-architecture.md#Repository Structure]

### Technical Constraints

- **分页**: 使用Spring Data的Pageable和Page
- **性能**: 响应时间小于100ms
- **安全**: 只返回当前用户的作品
- **排序**: 按创建时间倒序（最新的在前）

[Source: docs/fullstack-architecture.md#Tech Stack]

### Testing Requirements

- 使用JUnit 5和MockMvc进行Controller测试
- 测试文件位置：`backend/src/test/java/com/myshop/controller/WorkControllerTest.java`
- 测试分页功能
- 测试用户隔离
- 性能测试（响应时间）

[Source: docs/fullstack-architecture.md#Tech Stack]

## Testing

### Test File Location

测试文件应创建在：`backend/src/test/java/com/myshop/controller/WorkControllerTest.java`

### Test Standards

- 使用JUnit 5和Spring Boot Test
- 使用MockMvc测试REST接口
- 验证响应时间

### Test Scenarios

1. **查询作品列表测试**
   - 创建多个作品
   - 查询作品列表
   - 验证返回所有作品
   - 验证按创建时间倒序

2. **分页测试**
   - 创建多个作品（超过一页）
   - 测试第一页
   - 测试第二页
   - 验证分页信息正确

3. **用户隔离测试**
   - 创建多个用户的作品
   - 当前用户查询
   - 验证只返回当前用户的作品

4. **按标题搜索测试**（如果实现）
   - 创建多个作品（不同标题）
   - 按标题搜索
   - 验证只返回匹配的作品

5. **性能测试**
   - 验证响应时间小于100ms

### Success Criteria

- 作品列表查询接口能够正常返回作品
- 分页功能正常
- 只返回当前用户的作品
- 响应时间满足要求

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-15 | 1.0 | 初始故事创建 | Scrum Master |

## Dev Agent Record

### Agent Model Used

_To be filled by Dev Agent_

### Debug Log References

_To be filled by Dev Agent_

### Completion Notes List

_To be filled by Dev Agent_

### File List

_To be filled by Dev Agent_

## QA Results

_To be filled by QA Agent_

