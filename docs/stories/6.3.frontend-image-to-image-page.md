# Story 6.3: 前端图生图页面

## Status

Draft

## Story

**As a** user,
**I want** to upload an image and generate a new one on the frontend,
**so that** I can create image variations easily.

## Acceptance Criteria

1. 图生图页面已创建
2. 图片上传功能已实现（选择相册或拍照）
3. 图片预览已实现
4. 提示词输入框已实现
5. 相似度控制滑块已实现（0-100%）
6. 生成按钮已实现
7. 参数验证已实现
8. 页面UI美观，符合设计规范

## Tasks / Subtasks

- [ ] Task 1: 创建图生图页面 (AC: 1, 8)
  - [ ] 创建pages/generate/image-to-image.vue页面
  - [ ] 配置页面路由
  - [ ] 设计页面布局和样式
- [ ] Task 2: 实现图片上传功能 (AC: 2)
  - [ ] 添加图片选择按钮
  - [ ] 使用uni.chooseImage选择相册或拍照
  - [ ] 调用imageGenerationApi.uploadImage上传图片
  - [ ] 获取上传后的图片URL
  - [ ] 添加加载状态和错误处理
- [ ] Task 3: 实现图片预览 (AC: 3)
  - [ ] 显示上传的图片
  - [ ] 支持图片预览（点击放大）
  - [ ] 支持重新选择图片
- [ ] Task 4: 实现提示词输入 (AC: 4)
  - [ ] 添加提示词输入框
  - [ ] 支持多行输入
  - [ ] 添加字符计数
  - [ ] 添加提示词建议（可选）
- [ ] Task 5: 实现相似度控制 (AC: 5)
  - [ ] 添加相似度滑块（slider组件）
  - [ ] 设置范围0-100
  - [ ] 显示当前相似度值
  - [ ] 添加相似度说明（低相似度=更多变化，高相似度=保持原图特征）
- [ ] Task 6: 实现生成功能 (AC: 6, 7)
  - [ ] 添加"生成"按钮
  - [ ] 实现参数验证（图片、提示词必填）
  - [ ] 调用imageGenerationApi.imageToImage创建生成任务
  - [ ] 跳转到生成进度页面
  - [ ] 传递任务ID
  - [ ] 添加加载状态和错误处理
- [ ] Task 7: 实现参数验证 (AC: 7)
  - [ ] 验证图片已上传
  - [ ] 验证提示词不为空
  - [ ] 显示友好的验证错误信息

## Dev Notes

### Previous Story Insights

依赖Story 6.1（图片上传到OSS）、Story 6.2（图生图API接口实现）完成，确保相关API已实现。

### Data Models

使用后端返回的数据：
- UploadResponse: { url: string }
- ImageGenerationResponse: { taskId: number }

[Source: docs/fullstack-architecture.md#ImageGenerationTask（图像生成任务）]

### API Specifications

使用以下API：
- POST /api/image-generation/upload - 上传图片到OSS
- POST /api/image-generation/image-to-image - 创建图生图任务

[Source: docs/fullstack-architecture.md#API Specification]

### File Locations

**前端文件位置：**
```
frontend/
├── pages/
│   └── generate/
│       └── image-to-image.vue        # 图生图页面
└── api/
    └── imageGeneration.js           # 图像生成API（已存在）
```

[Source: docs/fullstack-architecture.md#Frontend Structure]

### Technical Constraints

- **框架**: uni-app (Vue 3 Composition API)
- **图片选择**: 使用uni.chooseImage选择相册或拍照
- **图片上传**: 先上传到OSS，获取URL后再创建生成任务
- **相似度控制**: 使用slider组件，范围0-100
- **UI组件**: 使用uni-app组件

[Source: docs/fullstack-architecture.md#Tech Stack]

### Testing Requirements

- 手动测试图生图页面功能
- 测试图片上传
- 测试参数输入和验证
- 测试生成任务创建

[Source: docs/fullstack-architecture.md#Tech Stack]

## Testing

### Test File Location

由于是前端页面，主要进行手动测试。

### Test Standards

- 在微信开发者工具中测试
- 测试各种交互场景
- 验证UI显示正确

### Test Scenarios

1. **图片上传测试**
   - 点击图片选择按钮
   - 选择相册图片或拍照
   - 验证图片上传成功
   - 验证图片预览正确显示

2. **提示词输入测试**
   - 输入提示词
   - 验证字符计数正确
   - 验证多行输入支持

3. **相似度控制测试**
   - 调整相似度滑块
   - 验证相似度值正确显示
   - 验证相似度说明清晰

4. **参数验证测试**
   - 不选择图片，点击生成
   - 验证提示选择图片
   - 不输入提示词，点击生成
   - 验证提示输入提示词

5. **生成任务创建测试**
   - 选择图片、输入提示词、设置相似度
   - 点击生成按钮
   - 验证生成任务创建成功
   - 验证跳转到生成进度页面
   - 验证任务ID正确传递

### Success Criteria

- 图生图页面能够正常显示
- 所有功能正常工作
- UI美观，符合设计规范
- 用户体验良好
- 参数验证正确

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-15 | 1.0 | 初始故事创建 | Scrum Master |

## Dev Agent Record

### Agent Model Used

_To be filled by Dev Agent_

### Debug Log References

_To be filled by Dev Agent_

### Completion Notes List

_To be filled by Dev Agent_

### File List

_To be filled by Dev Agent_

## QA Results

_To be filled by QA Agent_

