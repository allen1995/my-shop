# Story 4.1: 包包商品实体和数据库设计

## Status

Draft

## Story

**As a** developer,
**I want** to create the Product entity and database schema,
**so that** bag products can be stored and managed.

## Acceptance Criteria

1. Product实体类已创建，包含字段：id、name、type、description、basePrice、colors、sizes、imageUrl、createTime、updateTime
2. ProductRepository接口已创建
3. 数据库表自动创建功能已配置
4. 能够通过Repository进行商品的增删改查操作
5. 支持按类型查询商品列表
6. 实体类包含必要的验证注解

## Tasks / Subtasks

- [ ] Task 1: 创建Product实体类 (AC: 1, 6)
  - [ ] 创建Product.java实体类
  - [ ] 添加JPA注解
  - [ ] 添加字段：id、name、type、description、basePrice、colors、sizes、imageUrl、createTime、updateTime
  - [ ] 添加验证注解
  - [ ] 添加@PrePersist和@PreUpdate自动设置时间
  - [ ] 处理colors和sizes字段（数组，存储为JSON字符串）
- [ ] Task 2: 创建ProductRepository接口 (AC: 2, 4, 5)
  - [ ] 创建ProductRepository接口，继承JpaRepository
  - [ ] 添加findByType方法（按类型查询）
  - [ ] 添加findAll方法（查询所有商品）
- [ ] Task 3: 配置数据库自动创建 (AC: 3)
  - [ ] 确保application.yml中JPA配置正确
  - [ ] 验证数据库表能够自动创建
- [ ] Task 4: 创建单元测试 (AC: 4, 5)
  - [ ] 创建ProductRepositoryTest
  - [ ] 测试保存商品
  - [ ] 测试查询商品
  - [ ] 测试按类型查询

## Dev Notes

### Previous Story Insights

这是商品相关的第一个故事，没有前置依赖。

### Data Models

**Product实体类字段定义：**
- id: Long - 商品ID，主键，自增
- name: String - 商品名称，不能为空
- type: String - 商品类型（手提包、单肩包、双肩包等）
- description: String - 商品描述（可选）
- basePrice: BigDecimal - 基础价格
- colors: String[] - 可用颜色列表（数组，存储为JSON字符串）
- sizes: String[] - 可用尺寸列表（数组，存储为JSON字符串）
- imageUrl: String - 商品图片URL（OSS）
- createTime: LocalDateTime - 创建时间，自动设置
- updateTime: LocalDateTime - 更新时间，自动更新

**数据库表结构：**
```sql
CREATE TABLE products (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(200) NOT NULL,
    type VARCHAR(50),
    description TEXT,
    base_price DECIMAL(10, 2) NOT NULL,
    colors VARCHAR(500), -- JSON array
    sizes VARCHAR(500),  -- JSON array
    image_url VARCHAR(500),
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

[Source: docs/fullstack-architecture.md#Product（商品）]

### API Specifications

本故事不涉及API接口，仅创建数据模型和Repository层。

### File Locations

**后端文件位置：**
```
backend/src/main/java/com/myshop/
├── entity/
│   └── Product.java                  # 商品实体类
└── repository/
    └── ProductRepository.java        # 商品数据访问接口
```

[Source: docs/fullstack-architecture.md#Repository Structure]

### Technical Constraints

- **ORM框架**: Spring Data JPA
- **JSON字段**: colors和sizes字段存储为JSON字符串
- **价格字段**: 使用BigDecimal确保精度
- **时间字段**: 使用LocalDateTime，通过@PrePersist和@PreUpdate自动设置

[Source: docs/fullstack-architecture.md#Tech Stack]

### Testing Requirements

- 使用JUnit 5进行单元测试
- 测试文件位置：`backend/src/test/java/com/myshop/repository/ProductRepositoryTest.java`
- 测试Repository的CRUD操作
- 测试按类型查询

[Source: docs/fullstack-architecture.md#Tech Stack]

## Testing

### Test File Location

测试文件应创建在：`backend/src/test/java/com/myshop/repository/ProductRepositoryTest.java`

### Test Standards

- 使用JUnit 5和Spring Boot Test
- 使用@DataJpaTest进行Repository层测试
- 使用@Autowired注入Repository

### Test Scenarios

1. **创建商品测试**
   - 创建Product对象
   - 保存到数据库
   - 验证保存成功

2. **查询商品测试**
   - 保存商品后查询
   - 验证查询结果正确

3. **按类型查询测试**
   - 创建多个类型的商品
   - 按type查询
   - 验证只返回该类型的商品

### Success Criteria

- Product实体类创建成功
- ProductRepository接口创建成功
- 数据库表自动创建成功
- 所有Repository方法测试通过

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-15 | 1.0 | 初始故事创建 | Scrum Master |

## Dev Agent Record

### Agent Model Used

_To be filled by Dev Agent_

### Debug Log References

_To be filled by Dev Agent_

### Completion Notes List

_To be filled by Dev Agent_

### File List

_To be filled by Dev Agent_

## QA Results

_To be filled by QA Agent_

