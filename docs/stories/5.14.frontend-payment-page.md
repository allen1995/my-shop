# Story 5.14: 前端支付页面

## Status

Draft

## Story

**As a** user,
**I want** to complete payment on the frontend,
**so that** I can purchase my customized bag.

## Acceptance Criteria

1. 支付页面已创建
2. 调用后端创建支付订单接口
3. 调用 `uni.requestPayment` 发起微信支付
4. 支付成功后跳转到订单详情页
5. 支付失败时显示错误提示
6. 页面UI美观，符合设计规范

## Tasks / Subtasks

- [ ] Task 1: 创建支付页面 (AC: 1, 6)
  - [ ] 创建pages/order/payment.vue页面
  - [ ] 配置页面路由
  - [ ] 设计页面布局和样式
- [ ] Task 2: 实现支付订单创建 (AC: 2)
  - [ ] 接收订单ID参数
  - [ ] 调用orderApi.createPaymentOrder创建支付订单
  - [ ] 获取支付参数
  - [ ] 添加加载状态和错误处理
- [ ] Task 3: 实现微信支付 (AC: 3)
  - [ ] 调用uni.requestPayment发起微信支付
  - [ ] 传递支付参数（appId、timeStamp、nonceStr、package、signType、paySign）
  - [ ] 处理支付成功回调
  - [ ] 处理支付失败回调
- [ ] Task 4: 实现支付成功处理 (AC: 4)
  - [ ] 支付成功后跳转到订单详情页
  - [ ] 传递订单ID
  - [ ] 显示支付成功提示
- [ ] Task 5: 实现支付失败处理 (AC: 5)
  - [ ] 捕获支付失败错误
  - [ ] 显示错误提示
  - [ ] 提供重试按钮
- [ ] Task 6: 实现支付状态查询 (AC: 4, 5)
  - [ ] 支付完成后查询订单状态
  - [ ] 根据订单状态决定跳转或提示

## Dev Notes

### Previous Story Insights

依赖Story 5.9（创建支付订单API）完成，确保相关API已实现。

### Data Models

使用后端返回的支付参数：
- PaymentParams: { appId, timeStamp, nonceStr, package, signType, paySign }

[Source: docs/fullstack-architecture.md#Order（订单）]

### API Specifications

使用以下API：
- POST /api/orders/{orderId}/payment - 创建支付订单

[Source: docs/fullstack-architecture.md#API Specification]

### File Locations

**前端文件位置：**
```
frontend/
├── pages/
│   └── order/
│       └── payment.vue                # 支付页面
└── api/
    └── order.js                     # 订单API（已存在）
```

[Source: docs/fullstack-architecture.md#Frontend Structure]

### Technical Constraints

- **框架**: uni-app (Vue 3 Composition API)
- **支付API**: 使用uni.requestPayment发起微信支付
- **参数传递**: 通过URL参数传递订单ID
- **支付回调**: 处理支付成功和失败回调

[Source: docs/fullstack-architecture.md#Tech Stack]

### Testing Requirements

- 手动测试支付页面功能
- 测试微信支付流程
- 测试支付成功和失败处理
- 注意：需要在真实微信环境中测试支付功能

[Source: docs/fullstack-architecture.md#Tech Stack]

## Testing

### Test File Location

由于是前端页面，主要进行手动测试。

### Test Standards

- 在微信开发者工具或真实微信环境中测试
- 测试支付流程
- 验证支付成功和失败处理

### Test Scenarios

1. **支付订单创建测试**
   - 从订单确认页面跳转到支付页面
   - 验证支付订单创建成功
   - 验证支付参数获取正确

2. **微信支付测试**
   - 调用uni.requestPayment
   - 验证支付参数正确传递
   - 在微信中完成支付流程

3. **支付成功处理测试**
   - 支付成功后
   - 验证跳转到订单详情页
   - 验证订单状态更新为已支付
   - 验证显示支付成功提示

4. **支付失败处理测试**
   - 取消支付或支付失败
   - 验证显示错误提示
   - 验证提供重试按钮

5. **支付状态查询测试**
   - 支付完成后查询订单状态
   - 验证订单状态正确

### Success Criteria

- 支付页面能够正常显示
- 支付流程正常工作
- 支付成功和失败处理正确
- UI美观，符合设计规范
- 用户体验良好

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-15 | 1.0 | 初始故事创建 | Scrum Master |

## Dev Agent Record

### Agent Model Used

_To be filled by Dev Agent_

### Debug Log References

_To be filled by Dev Agent_

### Completion Notes List

_To be filled by Dev Agent_

### File List

_To be filled by Dev Agent_

## QA Results

_To be filled by QA Agent_

