{"version":3,"file":"cart.js","sources":["pages/cart/cart.vue","../../../software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY2FydC9jYXJ0LnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"cart-container\">\r\n    <view class=\"cart-list\" v-if=\"cartItems.length > 0\">\r\n      <view class=\"select-all-section\">\r\n        <checkbox-group @change=\"onSelectAllChange\">\r\n          <label class=\"select-all-label\">\r\n            <checkbox :checked=\"isAllSelected\" color=\"#667eea\" />\r\n            <text class=\"select-all-text\">全选</text>\r\n          </label>\r\n        </checkbox-group>\r\n      </view>\r\n      \r\n      <view class=\"cart-item\" v-for=\"item in cartItems\" :key=\"item.id\">\r\n        <checkbox-group @change=\"onItemSelectChange(item)\">\r\n          <label class=\"item-checkbox\">\r\n            <checkbox :checked=\"item.selected\" color=\"#667eea\" />\r\n          </label>\r\n        </checkbox-group>\r\n        <image class=\"item-image\" :src=\"item.previewImageUrl\" mode=\"aspectFill\"></image>\r\n        <view class=\"item-info\">\r\n          <text class=\"item-title\">{{ item.productName || '定制包包' }}</text>\r\n          <text class=\"item-spec\">颜色：{{ item.color }} | 尺寸：{{ item.size }}</text>\r\n          <view class=\"item-footer\">\r\n            <text class=\"item-price\">¥{{ item.price || 0 }}</text>\r\n            <view class=\"quantity-control\">\r\n              <text class=\"quantity-btn\" @click=\"decreaseQuantity(item)\">-</text>\r\n              <text class=\"quantity-value\">{{ item.quantity }}</text>\r\n              <text class=\"quantity-btn\" @click=\"increaseQuantity(item)\">+</text>\r\n            </view>\r\n          </view>\r\n        </view>\r\n        <text class=\"delete-btn\" @click=\"handleDelete(item.id)\">删除</text>\r\n      </view>\r\n    </view>\r\n    \r\n    <view class=\"empty-state\" v-else>\r\n      <image class=\"empty-icon\" src=\"/static/icons/empty-cart.png\" mode=\"aspectFit\"></image>\r\n      <text class=\"empty-text\">购物车是空的</text>\r\n      <button class=\"empty-btn\" @click=\"goToIndex\">去逛逛</button>\r\n    </view>\r\n    \r\n    <view class=\"footer-section\" v-if=\"cartItems.length > 0\">\r\n      <view class=\"total-info\">\r\n        <text class=\"total-label\">合计：</text>\r\n        <text class=\"total-amount\">¥{{ selectedAmount }}</text>\r\n        <text class=\"selected-count\">(已选{{ selectedCount }}件)</text>\r\n      </view>\r\n      <button class=\"checkout-btn\" @click=\"goToCheckout\" :disabled=\"selectedCount === 0\">去结算({{ selectedCount }})</button>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed, onMounted } from 'vue'\r\nimport { cartApi } from '@/api/cart'\r\nimport { onPullDownRefresh, onShow } from '@dcloudio/uni-app'\r\n\r\nconst cartItems = ref([])\r\n\r\nconst totalAmount = computed(() => {\r\n  return cartItems.value.reduce((sum, item) => {\r\n    return sum + (item.price || 0) * item.quantity\r\n  }, 0).toFixed(2)\r\n})\r\n\r\nconst selectedCount = computed(() => {\r\n  return cartItems.value.filter(item => item.selected).length\r\n})\r\n\r\nconst selectedAmount = computed(() => {\r\n  return cartItems.value\r\n    .filter(item => item.selected)\r\n    .reduce((sum, item) => {\r\n      return sum + (item.price || 0) * item.quantity\r\n    }, 0).toFixed(2)\r\n})\r\n\r\nconst isAllSelected = computed(() => {\r\n  return cartItems.value.length > 0 && cartItems.value.every(item => item.selected)\r\n})\r\n\r\nconst loadCartItems = async () => {\r\n  try {\r\n    console.log('开始加载购物车数据...')\r\n    const res = await cartApi.getCartItems()\r\n    console.log('购物车API响应:', res)\r\n    if (res.code === 200 && res.data) {\r\n      // 添加 selected 属性，默认全选\r\n      cartItems.value = (res.data || []).map(item => ({\r\n        ...item,\r\n        selected: true\r\n      }))\r\n      console.log('购物车数据加载成功，共', cartItems.value.length, '项')\r\n    } else {\r\n      console.warn('购物车加载失败:', res.message)\r\n      cartItems.value = []\r\n    }\r\n  } catch (error) {\r\n    console.error('加载购物车失败', error)\r\n    uni.showToast({\r\n      title: '加载购物车失败',\r\n      icon: 'none'\r\n    })\r\n    cartItems.value = []\r\n  } finally {\r\n    uni.stopPullDownRefresh()\r\n  }\r\n}\r\n\r\nconst onSelectAllChange = (e) => {\r\n  const checked = e.detail.value.length > 0\r\n  console.log('全选状态改变:', checked)\r\n  cartItems.value.forEach(item => {\r\n    item.selected = checked\r\n  })\r\n  // 强制更新视图\r\n  cartItems.value = [...cartItems.value]\r\n}\r\n\r\nconst onItemSelectChange = (item) => {\r\n  console.log('商品选择状态改变:', item.id, '当前状态:', item.selected)\r\n  item.selected = !item.selected\r\n  // 强制更新视图\r\n  cartItems.value = [...cartItems.value]\r\n}\r\n\r\nconst increaseQuantity = async (item) => {\r\n  try {\r\n    await cartApi.updateCartItem(item.id, {\r\n      quantity: item.quantity + 1\r\n    })\r\n    await loadCartItems()\r\n  } catch (error) {\r\n    uni.showToast({\r\n      title: '更新失败',\r\n      icon: 'none'\r\n    })\r\n  }\r\n}\r\n\r\nconst decreaseQuantity = async (item) => {\r\n  if (item.quantity <= 1) return\r\n  \r\n  try {\r\n    await cartApi.updateCartItem(item.id, {\r\n      quantity: item.quantity - 1\r\n    })\r\n    await loadCartItems()\r\n  } catch (error) {\r\n    uni.showToast({\r\n      title: '更新失败',\r\n      icon: 'none'\r\n    })\r\n  }\r\n}\r\n\r\nconst handleDelete = async (itemId) => {\r\n  uni.showModal({\r\n    title: '确认删除',\r\n    content: '确定要删除这个商品吗？',\r\n    success: async (res) => {\r\n      if (res.confirm) {\r\n        try {\r\n          await cartApi.deleteCartItem(itemId)\r\n          await loadCartItems()\r\n          uni.showToast({\r\n            title: '删除成功',\r\n            icon: 'success'\r\n          })\r\n        } catch (error) {\r\n          uni.showToast({\r\n            title: '删除失败',\r\n            icon: 'none'\r\n          })\r\n        }\r\n      }\r\n    }\r\n  })\r\n}\r\n\r\nconst goToCheckout = () => {\r\n  const selectedItems = cartItems.value.filter(item => item.selected)\r\n  \r\n  if (selectedItems.length === 0) {\r\n    uni.showToast({\r\n      title: '请选择要结算的商品',\r\n      icon: 'none'\r\n    })\r\n    return\r\n  }\r\n  \r\n  // 传递选中商品的ID列表\r\n  const selectedIds = selectedItems.map(item => item.id).join(',')\r\n  uni.navigateTo({\r\n    url: `/pages/order/confirm?itemIds=${selectedIds}`\r\n  })\r\n}\r\n\r\nconst goToIndex = () => {\r\n  uni.switchTab({\r\n    url: '/pages/index/index'\r\n  })\r\n}\r\n\r\nonMounted(() => {\r\n  loadCartItems()\r\n})\r\n\r\n// 在 tabBar 页面中，使用 onShow 确保每次显示时都刷新数据\r\nonShow(() => {\r\n  loadCartItems()\r\n})\r\n\r\nonPullDownRefresh(() => {\r\n  loadCartItems()\r\n})\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.cart-container {\r\n  min-height: 100vh;\r\n  background-color: #F8F8F8;\r\n  padding-bottom: 120rpx;\r\n}\r\n\r\n.cart-list {\r\n  padding: 20rpx;\r\n  \r\n  .select-all-section {\r\n    background: #ffffff;\r\n    border-radius: 20rpx;\r\n    padding: 30rpx;\r\n    margin-bottom: 20rpx;\r\n    \r\n    .select-all-label {\r\n      display: flex;\r\n      align-items: center;\r\n      \r\n      .select-all-text {\r\n        margin-left: 20rpx;\r\n        font-size: 28rpx;\r\n        color: #333333;\r\n      }\r\n    }\r\n  }\r\n  \r\n  .cart-item {\r\n    background: #ffffff;\r\n    border-radius: 20rpx;\r\n    padding: 30rpx;\r\n    margin-bottom: 20rpx;\r\n    display: flex;\r\n    align-items: center;\r\n    \r\n    .item-checkbox {\r\n      margin-right: 20rpx;\r\n    }\r\n    \r\n    .item-image {\r\n      width: 160rpx;\r\n      height: 160rpx;\r\n      border-radius: 10rpx;\r\n      margin-right: 20rpx;\r\n    }\r\n    \r\n    .item-info {\r\n      flex: 1;\r\n      \r\n      .item-title {\r\n        display: block;\r\n        font-size: 32rpx;\r\n        font-weight: bold;\r\n        color: #333333;\r\n        margin-bottom: 10rpx;\r\n      }\r\n      \r\n      .item-spec {\r\n        display: block;\r\n        font-size: 24rpx;\r\n        color: #999999;\r\n        margin-bottom: 20rpx;\r\n      }\r\n      \r\n      .item-footer {\r\n        display: flex;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n        \r\n        .item-price {\r\n          font-size: 36rpx;\r\n          font-weight: bold;\r\n          color: #FF3B30;\r\n        }\r\n        \r\n        .quantity-control {\r\n          display: flex;\r\n          align-items: center;\r\n          gap: 20rpx;\r\n          \r\n          .quantity-btn {\r\n            width: 50rpx;\r\n            height: 50rpx;\r\n            background: #F5F5F5;\r\n            border-radius: 8rpx;\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n            font-size: 32rpx;\r\n            color: #333333;\r\n          }\r\n          \r\n          .quantity-value {\r\n            font-size: 28rpx;\r\n            color: #333333;\r\n            min-width: 40rpx;\r\n            text-align: center;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    \r\n    .delete-btn {\r\n      padding: 10rpx 20rpx;\r\n      color: #FF3B30;\r\n      font-size: 28rpx;\r\n    }\r\n  }\r\n}\r\n\r\n.empty-state {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  padding: 200rpx 40rpx;\r\n  \r\n  .empty-icon {\r\n    width: 200rpx;\r\n    height: 200rpx;\r\n    margin-bottom: 40rpx;\r\n    opacity: 0.5;\r\n  }\r\n  \r\n  .empty-text {\r\n    font-size: 32rpx;\r\n    color: #999999;\r\n    margin-bottom: 40rpx;\r\n  }\r\n  \r\n  .empty-btn {\r\n    padding: 20rpx 60rpx;\r\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n    color: #ffffff;\r\n    border-radius: 44rpx;\r\n    font-size: 28rpx;\r\n    border: none;\r\n  }\r\n}\r\n\r\n.footer-section {\r\n  position: fixed;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  background: #ffffff;\r\n  padding: 30rpx 40rpx;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  box-shadow: 0 -4rpx 20rpx rgba(0, 0, 0, 0.1);\r\n  \r\n  .total-info {\r\n    display: flex;\r\n    align-items: baseline;\r\n    \r\n    .total-label {\r\n      font-size: 28rpx;\r\n      color: #666666;\r\n      margin-right: 10rpx;\r\n    }\r\n    \r\n    .total-amount {\r\n      font-size: 40rpx;\r\n      font-weight: bold;\r\n      color: #FF3B30;\r\n    }\r\n    \r\n    .selected-count {\r\n      font-size: 24rpx;\r\n      color: #999999;\r\n      margin-left: 10rpx;\r\n    }\r\n  }\r\n  \r\n  .checkout-btn {\r\n    padding: 20rpx 60rpx;\r\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n    color: #ffffff;\r\n    border-radius: 44rpx;\r\n    font-size: 32rpx;\r\n    font-weight: bold;\r\n    border: none;\r\n    \r\n    &[disabled] {\r\n      background: #CCCCCC;\r\n    }\r\n  }\r\n}\r\n</style>\r\n\r\n\r\n","import MiniProgramPage from 'D:/code/my-shop-cursor/frontend/pages/cart/cart.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","computed","uni","cartApi","onMounted","onShow","onPullDownRefresh"],"mappings":"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"}