{"version":3,"file":"payment.js","sources":["pages/order/payment.vue","../../../software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvb3JkZXIvcGF5bWVudC52dWU"],"sourcesContent":["<template>\r\n  <view class=\"payment-container\">\r\n    <view class=\"order-info-section\">\r\n      <text class=\"order-no\">订单号：{{ order.orderNo }}</text>\r\n      <text class=\"order-amount\">¥{{ order.totalAmount }}</text>\r\n    </view>\r\n    \r\n    <view class=\"payment-section\">\r\n      <text class=\"payment-title\">选择支付方式</text>\r\n      <view class=\"payment-method active\">\r\n        <image class=\"payment-icon\" src=\"/static/icons/wechat-pay.png\" mode=\"aspectFit\"></image>\r\n        <text class=\"payment-name\">微信支付</text>\r\n        <text class=\"payment-check\">✓</text>\r\n      </view>\r\n    </view>\r\n    \r\n    <view class=\"action-section\">\r\n      <button class=\"pay-btn\" @click=\"handlePay\" :loading=\"paying\">\r\n        立即支付\r\n      </button>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue'\r\nimport { orderApi } from '@/api/order'\r\nimport { onLoad } from '@dcloudio/uni-app'\r\n\r\nconst orderId = ref(null)\r\nconst order = ref({})\r\nconst paying = ref(false)\r\n\r\nonLoad(async (options) => {\r\n  orderId.value = options.orderId\r\n  await loadOrderDetail()\r\n})\r\n\r\nconst loadOrderDetail = async () => {\r\n  try {\r\n    const res = await orderApi.getOrderDetail(orderId.value)\r\n    if (res.code === 200 && res.data) {\r\n      order.value = res.data\r\n    }\r\n  } catch (error) {\r\n    console.error('加载订单详情失败', error)\r\n  }\r\n}\r\n\r\nconst handlePay = async () => {\r\n  paying.value = true\r\n  \r\n  try {\r\n    // 创建支付订单\r\n    const paymentRes = await orderApi.createPayment(orderId.value)\r\n    \r\n    if (paymentRes.code === 200) {\r\n      const paymentParams = paymentRes.data.data.paymentParams\r\n      \r\n      // 调用微信支付\r\n      uni.requestPayment({\r\n        provider: 'wxpay',\r\n        timeStamp: paymentParams.timeStamp,\r\n        nonceStr: paymentParams.nonceStr,\r\n        package: paymentParams.package,\r\n        signType: paymentParams.signType,\r\n        paySign: paymentParams.paySign,\r\n        success: () => {\r\n          uni.showToast({\r\n            title: '支付成功',\r\n            icon: 'success'\r\n          })\r\n          \r\n          setTimeout(() => {\r\n            uni.redirectTo({\r\n              url: `/pages/order/detail?id=${orderId.value}`\r\n            })\r\n          }, 1500)\r\n        },\r\n        fail: (err) => {\r\n          console.error('支付失败', err)\r\n          uni.showToast({\r\n            title: '支付失败',\r\n            icon: 'none'\r\n          })\r\n        }\r\n      })\r\n    }\r\n  } catch (error) {\r\n    console.error('支付错误', error)\r\n    uni.showToast({\r\n      title: '支付失败',\r\n      icon: 'none'\r\n    })\r\n  } finally {\r\n    paying.value = false\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.payment-container {\r\n  min-height: 100vh;\r\n  background-color: #F8F8F8;\r\n  padding-bottom: 120rpx;\r\n}\r\n\r\n.order-info-section {\r\n  background: #ffffff;\r\n  padding: 40rpx;\r\n  margin-bottom: 20rpx;\r\n  text-align: center;\r\n  \r\n  .order-no {\r\n    display: block;\r\n    font-size: 28rpx;\r\n    color: #666666;\r\n    margin-bottom: 20rpx;\r\n  }\r\n  \r\n  .order-amount {\r\n    display: block;\r\n    font-size: 60rpx;\r\n    font-weight: bold;\r\n    color: #FF3B30;\r\n  }\r\n}\r\n\r\n.payment-section {\r\n  background: #ffffff;\r\n  padding: 40rpx;\r\n  \r\n  .payment-title {\r\n    display: block;\r\n    font-size: 32rpx;\r\n    font-weight: bold;\r\n    color: #333333;\r\n    margin-bottom: 30rpx;\r\n  }\r\n  \r\n  .payment-method {\r\n    display: flex;\r\n    align-items: center;\r\n    padding: 30rpx;\r\n    background: #F5F5F5;\r\n    border-radius: 10rpx;\r\n    \r\n    &.active {\r\n      background: #E8F4FF;\r\n      border: 2rpx solid #007AFF;\r\n    }\r\n    \r\n    .payment-icon {\r\n      width: 60rpx;\r\n      height: 60rpx;\r\n      margin-right: 20rpx;\r\n    }\r\n    \r\n    .payment-name {\r\n      flex: 1;\r\n      font-size: 32rpx;\r\n      color: #333333;\r\n    }\r\n    \r\n    .payment-check {\r\n      font-size: 40rpx;\r\n      color: #007AFF;\r\n    }\r\n  }\r\n}\r\n\r\n.action-section {\r\n  position: fixed;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  padding: 30rpx 40rpx;\r\n  background: #ffffff;\r\n  box-shadow: 0 -4rpx 20rpx rgba(0, 0, 0, 0.1);\r\n  \r\n  .pay-btn {\r\n    width: 100%;\r\n    height: 88rpx;\r\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n    color: #ffffff;\r\n    border-radius: 44rpx;\r\n    font-size: 32rpx;\r\n    font-weight: bold;\r\n    border: none;\r\n  }\r\n}\r\n</style>\r\n\r\n\r\n","import MiniProgramPage from 'D:/code/my-shop-cursor/frontend/pages/order/payment.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onLoad","orderApi","uni"],"mappings":";;;;;;;AA6BA,UAAM,UAAUA,cAAG,IAAC,IAAI;AACxB,UAAM,QAAQA,cAAG,IAAC,EAAE;AACpB,UAAM,SAASA,cAAG,IAAC,KAAK;AAExBC,kBAAM,OAAC,OAAO,YAAY;AACxB,cAAQ,QAAQ,QAAQ;AACxB,YAAM,gBAAiB;AAAA,IACzB,CAAC;AAED,UAAM,kBAAkB,YAAY;AAClC,UAAI;AACF,cAAM,MAAM,MAAMC,UAAAA,SAAS,eAAe,QAAQ,KAAK;AACvD,YAAI,IAAI,SAAS,OAAO,IAAI,MAAM;AAChC,gBAAM,QAAQ,IAAI;AAAA,QACnB;AAAA,MACF,SAAQ,OAAO;AACdC,sBAAAA,MAAA,MAAA,SAAA,iCAAc,YAAY,KAAK;AAAA,MAChC;AAAA,IACH;AAEA,UAAM,YAAY,YAAY;AAC5B,aAAO,QAAQ;AAEf,UAAI;AAEF,cAAM,aAAa,MAAMD,UAAAA,SAAS,cAAc,QAAQ,KAAK;AAE7D,YAAI,WAAW,SAAS,KAAK;AAC3B,gBAAM,gBAAgB,WAAW,KAAK,KAAK;AAG3CC,wBAAAA,MAAI,eAAe;AAAA,YACjB,UAAU;AAAA,YACV,WAAW,cAAc;AAAA,YACzB,UAAU,cAAc;AAAA,YACxB,SAAS,cAAc;AAAA,YACvB,UAAU,cAAc;AAAA,YACxB,SAAS,cAAc;AAAA,YACvB,SAAS,MAAM;AACbA,4BAAAA,MAAI,UAAU;AAAA,gBACZ,OAAO;AAAA,gBACP,MAAM;AAAA,cAClB,CAAW;AAED,yBAAW,MAAM;AACfA,8BAAAA,MAAI,WAAW;AAAA,kBACb,KAAK,0BAA0B,QAAQ,KAAK;AAAA,gBAC1D,CAAa;AAAA,cACF,GAAE,IAAI;AAAA,YACR;AAAA,YACD,MAAM,CAAC,QAAQ;AACbA,4BAAAA,MAAc,MAAA,SAAA,iCAAA,QAAQ,GAAG;AACzBA,4BAAAA,MAAI,UAAU;AAAA,gBACZ,OAAO;AAAA,gBACP,MAAM;AAAA,cAClB,CAAW;AAAA,YACF;AAAA,UACT,CAAO;AAAA,QACF;AAAA,MACF,SAAQ,OAAO;AACdA,sBAAAA,sDAAc,QAAQ,KAAK;AAC3BA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACZ,CAAK;AAAA,MACL,UAAY;AACR,eAAO,QAAQ;AAAA,MAChB;AAAA,IACH;;;;;;;;;;;;;AChGA,GAAG,WAAW,eAAe;"}