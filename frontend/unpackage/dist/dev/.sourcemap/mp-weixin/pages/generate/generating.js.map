{"version":3,"file":"generating.js","sources":["pages/generate/generating.vue","../../../software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZ2VuZXJhdGUvZ2VuZXJhdGluZy52dWU"],"sourcesContent":["<template>\r\n  <view class=\"generating-container\">\r\n    <view class=\"progress-section\">\r\n      <image class=\"loading-icon\" src=\"/static/icons/loading.gif\" mode=\"aspectFit\"></image>\r\n      <text class=\"progress-text\">AI正在生成中...</text>\r\n      <view class=\"progress-bar\">\r\n        <view class=\"progress-fill\" :style=\"{ width: progress + '%' }\"></view>\r\n      </view>\r\n      <text class=\"progress-desc\">预计还需 {{ estimatedTime }} 秒</text>\r\n    </view>\r\n    \r\n    <view class=\"tips-section\">\r\n      <text class=\"tips-title\">生成提示</text>\r\n      <text class=\"tips-content\">• 生成时间通常需要20-30秒</text>\r\n      <text class=\"tips-content\">• 请保持网络连接畅通</text>\r\n      <text class=\"tips-content\">• 可以切换到其他页面，完成后会通知您</text>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, onUnmounted } from 'vue'\r\nimport { imageGenerationApi } from '@/api/imageGeneration'\r\nimport { onLoad } from '@dcloudio/uni-app'\r\n\r\nconst taskId = ref(null)\r\nconst progress = ref(0)\r\nconst estimatedTime = ref(30)\r\nlet pollTimer = null\r\n\r\nonLoad((options) => {\r\n  taskId.value = options.taskId\r\n  startPolling()\r\n})\r\n\r\nonUnmounted(() => {\r\n  if (pollTimer) {\r\n    clearInterval(pollTimer)\r\n  }\r\n})\r\n\r\nconst startPolling = () => {\r\n  pollTimer = setInterval(async () => {\r\n    try {\r\n      const res = await imageGenerationApi.getTaskStatus(taskId.value)\r\n      if (res.code === 200 && res.data) {\r\n        const task = res.data\r\n        \r\n        if (task.status === 'COMPLETED') {\r\n          // 生成完成，跳转到结果页\r\n          clearInterval(pollTimer)\r\n          if (task.resultUrl) {\r\n            uni.redirectTo({\r\n              url: `/pages/generate/result?taskId=${taskId.value}&imageUrl=${encodeURIComponent(task.resultUrl)}`\r\n            })\r\n          } else {\r\n            uni.showModal({\r\n              title: '生成完成',\r\n              content: '但未获取到结果图片，请重试',\r\n              showCancel: false,\r\n              success: () => {\r\n                uni.navigateBack()\r\n              }\r\n            })\r\n          }\r\n        } else if (task.status === 'FAILED') {\r\n          // 生成失败\r\n          clearInterval(pollTimer)\r\n          uni.showModal({\r\n            title: '生成失败',\r\n            content: task.errorMessage || '生成失败，请重试',\r\n            showCancel: true,\r\n            cancelText: '返回',\r\n            confirmText: '重试',\r\n            success: (modalRes) => {\r\n              if (modalRes.confirm) {\r\n                // 重试 - 重新开始轮询\r\n                progress.value = 0\r\n                estimatedTime.value = 30\r\n                startPolling()\r\n              } else {\r\n                uni.navigateBack()\r\n              }\r\n            }\r\n          })\r\n        } else if (task.status === 'PROCESSING' || task.status === 'PENDING') {\r\n          // 更新进度\r\n          progress.value = Math.min(progress.value + 5, 90)\r\n          estimatedTime.value = Math.max(estimatedTime.value - 1, 5)\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('查询任务状态失败', error)\r\n    }\r\n  }, 2000) // 每2秒轮询一次\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.generating-container {\r\n  min-height: 100vh;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  padding: 40rpx;\r\n  background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);\r\n}\r\n\r\n.progress-section {\r\n  width: 100%;\r\n  max-width: 600rpx;\r\n  background: #ffffff;\r\n  border-radius: 20rpx;\r\n  padding: 60rpx 40rpx;\r\n  text-align: center;\r\n  \r\n  .loading-icon {\r\n    width: 120rpx;\r\n    height: 120rpx;\r\n    margin-bottom: 40rpx;\r\n  }\r\n  \r\n  .progress-text {\r\n    display: block;\r\n    font-size: 36rpx;\r\n    font-weight: bold;\r\n    color: #333333;\r\n    margin-bottom: 40rpx;\r\n  }\r\n  \r\n  .progress-bar {\r\n    width: 100%;\r\n    height: 8rpx;\r\n    background: #F5F5F5;\r\n    border-radius: 4rpx;\r\n    overflow: hidden;\r\n    margin-bottom: 20rpx;\r\n    \r\n    .progress-fill {\r\n      height: 100%;\r\n      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);\r\n      transition: width 0.3s;\r\n    }\r\n  }\r\n  \r\n  .progress-desc {\r\n    display: block;\r\n    font-size: 24rpx;\r\n    color: #999999;\r\n  }\r\n}\r\n\r\n.tips-section {\r\n  margin-top: 60rpx;\r\n  width: 100%;\r\n  max-width: 600rpx;\r\n  background: rgba(255, 255, 255, 0.2);\r\n  border-radius: 20rpx;\r\n  padding: 40rpx;\r\n  \r\n  .tips-title {\r\n    display: block;\r\n    font-size: 32rpx;\r\n    font-weight: bold;\r\n    color: #ffffff;\r\n    margin-bottom: 20rpx;\r\n  }\r\n  \r\n  .tips-content {\r\n    display: block;\r\n    font-size: 28rpx;\r\n    color: rgba(255, 255, 255, 0.9);\r\n    line-height: 1.8;\r\n    margin-bottom: 10rpx;\r\n  }\r\n}\r\n</style>\r\n\r\n\r\n","import MiniProgramPage from 'D:/code/my-shop-cursor/frontend/pages/generate/generating.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onLoad","onUnmounted","imageGenerationApi","uni"],"mappings":";;;;;;;AAyBA,UAAM,SAASA,cAAG,IAAC,IAAI;AACvB,UAAM,WAAWA,cAAG,IAAC,CAAC;AACtB,UAAM,gBAAgBA,cAAG,IAAC,EAAE;AAC5B,QAAI,YAAY;AAEhBC,kBAAM,OAAC,CAAC,YAAY;AAClB,aAAO,QAAQ,QAAQ;AACvB,mBAAc;AAAA,IAChB,CAAC;AAEDC,kBAAAA,YAAY,MAAM;AAChB,UAAI,WAAW;AACb,sBAAc,SAAS;AAAA,MACxB;AAAA,IACH,CAAC;AAED,UAAM,eAAe,MAAM;AACzB,kBAAY,YAAY,YAAY;AAClC,YAAI;AACF,gBAAM,MAAM,MAAMC,oBAAAA,mBAAmB,cAAc,OAAO,KAAK;AAC/D,cAAI,IAAI,SAAS,OAAO,IAAI,MAAM;AAChC,kBAAM,OAAO,IAAI;AAEjB,gBAAI,KAAK,WAAW,aAAa;AAE/B,4BAAc,SAAS;AACvB,kBAAI,KAAK,WAAW;AAClBC,8BAAAA,MAAI,WAAW;AAAA,kBACb,KAAK,iCAAiC,OAAO,KAAK,aAAa,mBAAmB,KAAK,SAAS,CAAC;AAAA,gBAC/G,CAAa;AAAA,cACb,OAAiB;AACLA,8BAAAA,MAAI,UAAU;AAAA,kBACZ,OAAO;AAAA,kBACP,SAAS;AAAA,kBACT,YAAY;AAAA,kBACZ,SAAS,MAAM;AACbA,kCAAAA,MAAI,aAAc;AAAA,kBACnB;AAAA,gBACf,CAAa;AAAA,cACF;AAAA,YACX,WAAmB,KAAK,WAAW,UAAU;AAEnC,4BAAc,SAAS;AACvBA,4BAAAA,MAAI,UAAU;AAAA,gBACZ,OAAO;AAAA,gBACP,SAAS,KAAK,gBAAgB;AAAA,gBAC9B,YAAY;AAAA,gBACZ,YAAY;AAAA,gBACZ,aAAa;AAAA,gBACb,SAAS,CAAC,aAAa;AACrB,sBAAI,SAAS,SAAS;AAEpB,6BAAS,QAAQ;AACjB,kCAAc,QAAQ;AACtB,iCAAc;AAAA,kBAC9B,OAAqB;AACLA,kCAAAA,MAAI,aAAc;AAAA,kBACnB;AAAA,gBACF;AAAA,cACb,CAAW;AAAA,YACX,WAAmB,KAAK,WAAW,gBAAgB,KAAK,WAAW,WAAW;AAEpE,uBAAS,QAAQ,KAAK,IAAI,SAAS,QAAQ,GAAG,EAAE;AAChD,4BAAc,QAAQ,KAAK,IAAI,cAAc,QAAQ,GAAG,CAAC;AAAA,YAC1D;AAAA,UACF;AAAA,QACF,SAAQ,OAAO;AACdA,wBAAAA,4DAAc,YAAY,KAAK;AAAA,QAChC;AAAA,MACF,GAAE,GAAI;AAAA,IACT;;;;;;;;;;;AC9FA,GAAG,WAAW,eAAe;"}