{"version":3,"file":"list.js","sources":["pages/address/list.vue","../../../software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYWRkcmVzcy9saXN0LnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"address-list-container\">\r\n    <view class=\"address-list\" v-if=\"addresses.length > 0\">\r\n      <view \r\n        class=\"address-card\" \r\n        v-for=\"address in addresses\" \r\n        :key=\"address.id\"\r\n        :class=\"{ 'default': address.isDefault, 'select-mode': isSelectMode }\"\r\n        @click=\"handleSelectAddress(address)\"\r\n      >\r\n        <view class=\"address-header\">\r\n          <text class=\"receiver-name\">{{ address.receiverName || '' }}</text>\r\n          <text class=\"receiver-phone\">{{ address.receiverPhone || '' }}</text>\r\n          <view class=\"default-badge\" v-if=\"address.isDefault\">默认</view>\r\n        </view>\r\n        \r\n        <view class=\"address-content\">\r\n          <text class=\"address-text\">\r\n            {{ (address.province || '') }}{{ (address.city || '') }}{{ (address.district || '') }}{{ (address.detailAddress || '') }}\r\n          </text>\r\n        </view>\r\n        \r\n        <view class=\"address-actions\" v-if=\"!isSelectMode\">\r\n          <view class=\"action-item\" @click.stop=\"handleEdit(address)\">\r\n            <text class=\"action-text\">编辑</text>\r\n          </view>\r\n          <view class=\"action-item\" @click.stop=\"handleDelete(address)\" v-if=\"!address.isDefault\">\r\n            <text class=\"action-text delete\">删除</text>\r\n          </view>\r\n          <view class=\"action-item\" @click.stop=\"handleSetDefault(address)\" v-if=\"!address.isDefault\">\r\n            <text class=\"action-text\">设为默认</text>\r\n          </view>\r\n        </view>\r\n      </view>\r\n    </view>\r\n    \r\n    <view class=\"empty-state\" v-else>\r\n      <text class=\"empty-text\">暂无收货地址</text>\r\n      <text class=\"empty-hint\">点击下方按钮添加地址</text>\r\n    </view>\r\n    \r\n    <view class=\"add-button-section\">\r\n      <button class=\"add-btn\" @click=\"handleAdd\">+ 添加新地址</button>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from 'vue'\r\nimport { addressApi } from '@/api/address'\r\nimport { onShow, onLoad } from '@dcloudio/uni-app'\r\n\r\nconst addresses = ref([])\r\nconst isSelectMode = ref(false) // 是否为选择模式\r\n\r\nconst loadAddresses = async () => {\r\n  try {\r\n    const res = await addressApi.getAddresses()\r\n    console.log('地址列表API响应:', res)\r\n    if (res.code === 200 && res.data) {\r\n      // 确保data是数组\r\n      const addressList = Array.isArray(res.data) ? res.data : [res.data]\r\n      console.log('地址列表数据:', addressList)\r\n      // 验证每个地址对象的字段\r\n      addressList.forEach((addr, index) => {\r\n        console.log(`地址${index}:`, {\r\n          id: addr.id,\r\n          receiverName: addr.receiverName,\r\n          receiverPhone: addr.receiverPhone,\r\n          province: addr.province,\r\n          city: addr.city,\r\n          district: addr.district,\r\n          detailAddress: addr.detailAddress,\r\n          isDefault: addr.isDefault\r\n        })\r\n      })\r\n      // 确保每个地址对象都有所有必需的字段\r\n      addresses.value = addressList.map(addr => ({\r\n        id: addr.id,\r\n        receiverName: addr.receiverName || '',\r\n        receiverPhone: addr.receiverPhone || '',\r\n        province: addr.province || '',\r\n        city: addr.city || '',\r\n        district: addr.district || '',\r\n        detailAddress: addr.detailAddress || '',\r\n        isDefault: addr.isDefault || false\r\n      }))\r\n    } else {\r\n      console.warn('地址列表响应异常:', res)\r\n    }\r\n  } catch (error) {\r\n    console.error('加载地址列表失败', error)\r\n  }\r\n}\r\n\r\nonLoad((options) => {\r\n  // 检查是否为选择模式\r\n  if (options.select === 'true') {\r\n    isSelectMode.value = true\r\n    // 设置页面标题\r\n    uni.setNavigationBarTitle({\r\n      title: '选择收货地址'\r\n    })\r\n  }\r\n})\r\n\r\nconst handleAdd = () => {\r\n  uni.navigateTo({\r\n    url: '/pages/address/edit'\r\n  })\r\n}\r\n\r\n// 选择地址（选择模式）\r\nconst handleSelectAddress = (address) => {\r\n  if (isSelectMode.value) {\r\n    // 返回上一页并传递选中的地址ID\r\n    const pages = getCurrentPages()\r\n    if (pages.length > 1) {\r\n      const prevPage = pages[pages.length - 2]\r\n      // 使用事件总线或全局数据传递选中的地址\r\n      getApp().globalData = getApp().globalData || {}\r\n      getApp().globalData.selectedAddress = address\r\n      uni.navigateBack()\r\n    }\r\n  }\r\n}\r\n\r\nconst handleEdit = (address) => {\r\n  uni.navigateTo({\r\n    url: `/pages/address/edit?id=${address.id}`\r\n  })\r\n}\r\n\r\nconst handleDelete = (address) => {\r\n  uni.showModal({\r\n    title: '确认删除',\r\n    content: '确定要删除这个地址吗？',\r\n    success: async (res) => {\r\n      if (res.confirm) {\r\n        try {\r\n          const deleteRes = await addressApi.deleteAddress(address.id)\r\n          if (deleteRes.code === 200) {\r\n            uni.showToast({\r\n              title: '删除成功',\r\n              icon: 'success'\r\n            })\r\n            loadAddresses()\r\n          } else {\r\n            uni.showToast({\r\n              title: deleteRes.message || '删除失败',\r\n              icon: 'none'\r\n            })\r\n          }\r\n        } catch (error) {\r\n          uni.showToast({\r\n            title: '删除失败',\r\n            icon: 'none'\r\n          })\r\n        }\r\n      }\r\n    }\r\n  })\r\n}\r\n\r\nconst handleSetDefault = async (address) => {\r\n  try {\r\n    const res = await addressApi.setDefaultAddress(address.id)\r\n    if (res.code === 200) {\r\n      uni.showToast({\r\n        title: '设置成功',\r\n        icon: 'success'\r\n      })\r\n      loadAddresses()\r\n    } else {\r\n      uni.showToast({\r\n        title: res.message || '设置失败',\r\n        icon: 'none'\r\n      })\r\n    }\r\n  } catch (error) {\r\n    uni.showToast({\r\n      title: '设置失败',\r\n      icon: 'none'\r\n    })\r\n  }\r\n}\r\n\r\nonMounted(() => {\r\n  loadAddresses()\r\n})\r\n\r\nonShow(() => {\r\n  loadAddresses()\r\n})\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.address-list-container {\r\n  min-height: 100vh;\r\n  background-color: #F8F8F8;\r\n  padding-bottom: 200rpx;\r\n}\r\n\r\n.address-list {\r\n  padding: 20rpx;\r\n  \r\n  .address-card {\r\n    background: #ffffff;\r\n    border-radius: 20rpx;\r\n    padding: 30rpx;\r\n    margin-bottom: 20rpx;\r\n    box-shadow: 0 4rpx 20rpx rgba(0, 0, 0, 0.05);\r\n    border: 2rpx solid transparent;\r\n    \r\n    &.default {\r\n      border-color: #667eea;\r\n    }\r\n    \r\n    &.select-mode {\r\n      cursor: pointer;\r\n      \r\n      &:active {\r\n        background: #F5F5F5;\r\n      }\r\n    }\r\n    \r\n    .address-header {\r\n      display: flex;\r\n      align-items: center;\r\n      margin-bottom: 20rpx;\r\n      \r\n      .receiver-name {\r\n        font-size: 32rpx;\r\n        font-weight: bold;\r\n        color: #333333;\r\n        margin-right: 20rpx;\r\n      }\r\n      \r\n      .receiver-phone {\r\n        font-size: 28rpx;\r\n        color: #666666;\r\n        margin-right: 20rpx;\r\n      }\r\n      \r\n      .default-badge {\r\n        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n        color: #ffffff;\r\n        font-size: 22rpx;\r\n        padding: 4rpx 12rpx;\r\n        border-radius: 10rpx;\r\n      }\r\n    }\r\n    \r\n    .address-content {\r\n      margin-bottom: 20rpx;\r\n      \r\n      .address-text {\r\n        font-size: 28rpx;\r\n        color: #666666;\r\n        line-height: 1.6;\r\n      }\r\n    }\r\n    \r\n    .address-actions {\r\n      display: flex;\r\n      gap: 30rpx;\r\n      padding-top: 20rpx;\r\n      border-top: 1rpx solid #F5F5F5;\r\n      \r\n      .action-item {\r\n        .action-text {\r\n          font-size: 26rpx;\r\n          color: #007AFF;\r\n          \r\n          &.delete {\r\n            color: #FF3B30;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n.empty-state {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  padding: 200rpx 40rpx;\r\n  \r\n  .empty-text {\r\n    font-size: 32rpx;\r\n    color: #999999;\r\n    margin-bottom: 20rpx;\r\n  }\r\n  \r\n  .empty-hint {\r\n    font-size: 26rpx;\r\n    color: #CCCCCC;\r\n  }\r\n}\r\n\r\n.add-button-section {\r\n  position: fixed;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  padding: 30rpx 40rpx;\r\n  background: #ffffff;\r\n  box-shadow: 0 -4rpx 20rpx rgba(0, 0, 0, 0.1);\r\n  \r\n  .add-btn {\r\n    width: 100%;\r\n    height: 88rpx;\r\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n    color: #ffffff;\r\n    border-radius: 44rpx;\r\n    font-size: 32rpx;\r\n    font-weight: bold;\r\n    border: none;\r\n  }\r\n}\r\n</style>\r\n\r\n","import MiniProgramPage from 'D:/code/my-shop-cursor/frontend/pages/address/list.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","addressApi","uni","onLoad","onMounted","onShow"],"mappings":"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"}