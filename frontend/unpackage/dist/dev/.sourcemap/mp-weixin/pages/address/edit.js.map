{"version":3,"file":"edit.js","sources":["pages/address/edit.vue","../../../software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYWRkcmVzcy9lZGl0LnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"address-edit-container\">\r\n    <view class=\"form-section\">\r\n      <view class=\"form-item\">\r\n        <text class=\"form-label\">收货人</text>\r\n        <input \r\n          class=\"form-input\" \r\n          v-model=\"formData.receiverName\" \r\n          placeholder=\"请输入收货人姓名\"\r\n          maxlength=\"50\"\r\n        />\r\n      </view>\r\n      \r\n      <view class=\"form-item\">\r\n        <text class=\"form-label\">手机号</text>\r\n        <input \r\n          class=\"form-input\" \r\n          v-model=\"formData.receiverPhone\" \r\n          placeholder=\"请输入手机号\"\r\n          type=\"number\"\r\n          maxlength=\"11\"\r\n        />\r\n      </view>\r\n      \r\n      <view class=\"form-item\">\r\n        <text class=\"form-label\">所在地区</text>\r\n        <picker \r\n          mode=\"multiSelector\" \r\n          :value=\"pickerValue\" \r\n          :range=\"pickerRange\"\r\n          :range-key=\"['name', 'name', 'name']\"\r\n          @change=\"onRegionChange\"\r\n        >\r\n          <view class=\"picker-view\">\r\n            <text v-if=\"formData.province\">{{ formData.province }}{{ formData.city }}{{ formData.district }}</text>\r\n            <text v-else class=\"placeholder\">请选择省市区</text>\r\n          </view>\r\n        </picker>\r\n      </view>\r\n      \r\n      <view class=\"form-item\">\r\n        <text class=\"form-label\">详细地址</text>\r\n        <textarea \r\n          class=\"form-textarea\" \r\n          v-model=\"formData.detailAddress\" \r\n          placeholder=\"请输入详细地址\"\r\n          maxlength=\"200\"\r\n        />\r\n      </view>\r\n      \r\n      <view class=\"form-item checkbox-item\">\r\n        <text class=\"form-label\">设为默认地址</text>\r\n        <switch \r\n          :checked=\"formData.isDefault\" \r\n          @change=\"onDefaultChange\"\r\n          color=\"#667eea\"\r\n        />\r\n      </view>\r\n    </view>\r\n    \r\n    <view class=\"save-button-section\">\r\n      <button class=\"save-btn\" @click=\"handleSave\" :disabled=\"!canSave\">保存</button>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed, onMounted } from 'vue'\r\nimport { addressApi } from '@/api/address'\r\nimport { onLoad } from '@dcloudio/uni-app'\r\n\r\nconst addressId = ref(null)\r\nconst formData = ref({\r\n  receiverName: '',\r\n  receiverPhone: '',\r\n  province: '',\r\n  city: '',\r\n  district: '',\r\n  detailAddress: '',\r\n  isDefault: false\r\n})\r\n\r\n// 省市区数据（简化版，实际应该从后端获取或使用第三方库）\r\nconst provinces = [\r\n  { name: '北京市', cities: [{ name: '北京市', districts: [{ name: '东城区' }, { name: '西城区' }, { name: '朝阳区' }] }] },\r\n  { name: '上海市', cities: [{ name: '上海市', districts: [{ name: '黄浦区' }, { name: '徐汇区' }, { name: '长宁区' }] }] },\r\n  { name: '广东省', cities: [\r\n    { name: '广州市', districts: [{ name: '越秀区' }, { name: '海珠区' }, { name: '天河区' }] },\r\n    { name: '深圳市', districts: [{ name: '罗湖区' }, { name: '福田区' }, { name: '南山区' }] }\r\n  ] }\r\n]\r\n\r\nconst pickerValue = ref([0, 0, 0])\r\nconst pickerRange = computed(() => {\r\n  const provinceList = provinces.map(p => p.name)\r\n  const cityList = provinces[pickerValue.value[0]]?.cities.map(c => c.name) || []\r\n  const districtList = provinces[pickerValue.value[0]]?.cities[pickerValue.value[1]]?.districts.map(d => d.name) || []\r\n  return [provinceList, cityList, districtList]\r\n})\r\n\r\nconst canSave = computed(() => {\r\n  return formData.value.receiverName.trim() &&\r\n         formData.value.receiverPhone.trim() &&\r\n         formData.value.province &&\r\n         formData.value.city &&\r\n         formData.value.district &&\r\n         formData.value.detailAddress.trim()\r\n})\r\n\r\nonLoad(async (options) => {\r\n  if (options.id) {\r\n    addressId.value = options.id\r\n    await loadAddress()\r\n  }\r\n})\r\n\r\nconst loadAddress = async () => {\r\n  try {\r\n    const res = await addressApi.getAddress(addressId.value)\r\n    if (res.code === 200 && res.data) {\r\n      formData.value = {\r\n        receiverName: res.data.receiverName,\r\n        receiverPhone: res.data.receiverPhone,\r\n        province: res.data.province,\r\n        city: res.data.city,\r\n        district: res.data.district,\r\n        detailAddress: res.data.detailAddress,\r\n        isDefault: res.data.isDefault\r\n      }\r\n      \r\n      // 设置picker值（简化处理）\r\n      const provinceIndex = provinces.findIndex(p => p.name === res.data.province)\r\n      if (provinceIndex >= 0) {\r\n        const cityIndex = provinces[provinceIndex].cities.findIndex(c => c.name === res.data.city)\r\n        if (cityIndex >= 0) {\r\n          const districtIndex = provinces[provinceIndex].cities[cityIndex].districts.findIndex(d => d.name === res.data.district)\r\n          if (districtIndex >= 0) {\r\n            pickerValue.value = [provinceIndex, cityIndex, districtIndex]\r\n          }\r\n        }\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error('加载地址失败', error)\r\n  }\r\n}\r\n\r\nconst onRegionChange = (e) => {\r\n  const [provinceIndex, cityIndex, districtIndex] = e.detail.value\r\n  pickerValue.value = [provinceIndex, cityIndex, districtIndex]\r\n  \r\n  formData.value.province = provinces[provinceIndex].name\r\n  formData.value.city = provinces[provinceIndex].cities[cityIndex].name\r\n  formData.value.district = provinces[provinceIndex].cities[cityIndex].districts[districtIndex].name\r\n}\r\n\r\nconst onDefaultChange = (e) => {\r\n  formData.value.isDefault = e.detail.value\r\n}\r\n\r\nconst handleSave = async () => {\r\n  if (!canSave.value) {\r\n    uni.showToast({\r\n      title: '请填写完整信息',\r\n      icon: 'none'\r\n    })\r\n    return\r\n  }\r\n  \r\n  // 手机号验证\r\n  if (!formData.value.receiverPhone.match(/^1[3-9]\\d{9}$/)) {\r\n    uni.showToast({\r\n      title: '手机号格式不正确',\r\n      icon: 'none'\r\n    })\r\n    return\r\n  }\r\n  \r\n  try {\r\n    console.log('保存地址 - addressId:', addressId.value, 'formData:', formData.value)\r\n    \r\n    let res\r\n    if (addressId.value) {\r\n      res = await addressApi.updateAddress(addressId.value, formData.value)\r\n    } else {\r\n      res = await addressApi.createAddress(formData.value)\r\n    }\r\n    \r\n    console.log('地址保存响应:', res)\r\n    \r\n    if (res.code === 200) {\r\n      // 验证返回的地址数据\r\n      if (res.data) {\r\n        console.log('保存成功，返回的地址数据:', res.data)\r\n        console.log('地址字段验证:', {\r\n          id: res.data.id,\r\n          receiverName: res.data.receiverName,\r\n          receiverPhone: res.data.receiverPhone,\r\n          province: res.data.province,\r\n          city: res.data.city,\r\n          district: res.data.district,\r\n          detailAddress: res.data.detailAddress,\r\n          isDefault: res.data.isDefault\r\n        })\r\n      }\r\n      \r\n      uni.showToast({\r\n        title: '保存成功',\r\n        icon: 'success'\r\n      })\r\n      \r\n      setTimeout(() => {\r\n        uni.navigateBack()\r\n      }, 1500)\r\n    } else {\r\n      console.error('地址保存失败:', res.message)\r\n      uni.showToast({\r\n        title: res.message || '保存失败',\r\n        icon: 'none'\r\n      })\r\n    }\r\n  } catch (error) {\r\n    console.error('地址保存异常:', error)\r\n    uni.showToast({\r\n      title: error.message || '保存失败',\r\n      icon: 'none'\r\n    })\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.address-edit-container {\r\n  min-height: 100vh;\r\n  background-color: #F8F8F8;\r\n  padding-bottom: 200rpx;\r\n}\r\n\r\n.form-section {\r\n  background: #ffffff;\r\n  margin: 20rpx;\r\n  border-radius: 20rpx;\r\n  padding: 30rpx;\r\n  \r\n  .form-item {\r\n    display: flex;\r\n    align-items: center;\r\n    padding: 30rpx 0;\r\n    border-bottom: 1rpx solid #F5F5F5;\r\n    \r\n    &:last-child {\r\n      border-bottom: none;\r\n    }\r\n    \r\n    &.checkbox-item {\r\n      justify-content: space-between;\r\n    }\r\n    \r\n    .form-label {\r\n      width: 160rpx;\r\n      font-size: 28rpx;\r\n      color: #333333;\r\n      flex-shrink: 0;\r\n    }\r\n    \r\n    .form-input {\r\n      flex: 1;\r\n      font-size: 28rpx;\r\n      color: #333333;\r\n    }\r\n    \r\n    .form-textarea {\r\n      flex: 1;\r\n      font-size: 28rpx;\r\n      color: #333333;\r\n      min-height: 120rpx;\r\n    }\r\n    \r\n    .picker-view {\r\n      flex: 1;\r\n      font-size: 28rpx;\r\n      color: #333333;\r\n      \r\n      .placeholder {\r\n        color: #CCCCCC;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n.save-button-section {\r\n  position: fixed;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  padding: 30rpx 40rpx;\r\n  background: #ffffff;\r\n  box-shadow: 0 -4rpx 20rpx rgba(0, 0, 0, 0.1);\r\n  \r\n  .save-btn {\r\n    width: 100%;\r\n    height: 88rpx;\r\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n    color: #ffffff;\r\n    border-radius: 44rpx;\r\n    font-size: 32rpx;\r\n    font-weight: bold;\r\n    border: none;\r\n    \r\n    &[disabled] {\r\n      background: #CCCCCC;\r\n    }\r\n  }\r\n}\r\n</style>\r\n\r\n","import MiniProgramPage from 'D:/code/my-shop-cursor/frontend/pages/address/edit.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","computed","onLoad","addressApi","uni"],"mappings":"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"}