{"version":3,"file":"preview.js","sources":["pages/preview/preview.vue","../../../software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcHJldmlldy9wcmV2aWV3LnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"preview-container\">\r\n    <view class=\"preview-section\">\r\n      <canvas \r\n        canvas-id=\"previewCanvas\" \r\n        class=\"preview-canvas\"\r\n        :style=\"{ width: canvasWidth + 'px', height: canvasHeight + 'px' }\"\r\n      ></canvas>\r\n    </view>\r\n    \r\n    <view class=\"product-section\">\r\n      <view class=\"product-selector\">\r\n        <text class=\"selector-label\">选择包包款式</text>\r\n        <picker :range=\"products\" range-key=\"name\" @change=\"onProductChange\">\r\n          <view class=\"picker-view\">{{ selectedProduct?.name || '请选择' }}</view>\r\n        </picker>\r\n      </view>\r\n      \r\n      <view class=\"spec-selector\" v-if=\"selectedProduct\">\r\n        <view class=\"spec-item\">\r\n          <text class=\"spec-label\">颜色</text>\r\n          <view class=\"spec-options\">\r\n            <view \r\n              class=\"spec-option\" \r\n              v-for=\"color in selectedProduct.colors\" \r\n              :key=\"color\"\r\n              :class=\"{ active: selectedColor === color }\"\r\n              @click=\"selectedColor = color\"\r\n            >{{ color }}</view>\r\n          </view>\r\n        </view>\r\n        \r\n        <view class=\"spec-item\">\r\n          <text class=\"spec-label\">尺寸</text>\r\n          <view class=\"spec-options\">\r\n            <view \r\n              class=\"spec-option\" \r\n              v-for=\"size in selectedProduct.sizes\" \r\n              :key=\"size\"\r\n              :class=\"{ active: selectedSize === size }\"\r\n              @click=\"selectedSize = size\"\r\n            >{{ size }}</view>\r\n          </view>\r\n        </view>\r\n      </view>\r\n    </view>\r\n    \r\n    <view class=\"action-section\">\r\n      <button class=\"add-cart-btn\" @click=\"handleAddToCart\" :disabled=\"!canAddToCart\">\r\n        加入购物车\r\n      </button>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed, onMounted } from 'vue'\r\nimport { productApi } from '@/api/product'\r\nimport { cartApi } from '@/api/cart'\r\nimport { onLoad } from '@dcloudio/uni-app'\r\n\r\nconst workId = ref(null)\r\nconst imageUrl = ref('')\r\nconst products = ref([])\r\nconst selectedProduct = ref(null)\r\nconst selectedColor = ref('')\r\nconst selectedSize = ref('')\r\nconst canvasWidth = ref(750)\r\nconst canvasHeight = ref(750)\r\n\r\nconst canAddToCart = computed(() => {\r\n  return selectedProduct.value && selectedColor.value && selectedSize.value\r\n})\r\n\r\nonLoad(async (options) => {\r\n  workId.value = options.workId\r\n  imageUrl.value = decodeURIComponent(options.imageUrl || '')\r\n  await loadProducts()\r\n})\r\n\r\nconst loadProducts = async () => {\r\n  try {\r\n    const res = await productApi.getProducts()\r\n    if (res.code === 200 && res.data) {\r\n      products.value = res.data || []\r\n      if (products.value.length > 0) {\r\n        selectedProduct.value = products.value[0]\r\n        if (selectedProduct.value.colors && selectedProduct.value.colors.length > 0) {\r\n          selectedColor.value = selectedProduct.value.colors[0]\r\n        }\r\n        if (selectedProduct.value.sizes && selectedProduct.value.sizes.length > 0) {\r\n          selectedSize.value = selectedProduct.value.sizes[0]\r\n        }\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error('加载商品失败', error)\r\n  }\r\n}\r\n\r\nconst onProductChange = (e) => {\r\n  selectedProduct.value = products.value[e.detail.value]\r\n  if (selectedProduct.value.colors && selectedProduct.value.colors.length > 0) {\r\n    selectedColor.value = selectedProduct.value.colors[0]\r\n  }\r\n  if (selectedProduct.value.sizes && selectedProduct.value.sizes.length > 0) {\r\n    selectedSize.value = selectedProduct.value.sizes[0]\r\n  }\r\n}\r\n\r\nconst handleAddToCart = async () => {\r\n  if (!canAddToCart.value) return\r\n  \r\n  try {\r\n    const res = await cartApi.addToCart({\r\n      workId: workId.value,\r\n      productId: selectedProduct.value.id,\r\n      color: selectedColor.value,\r\n      size: selectedSize.value,\r\n      quantity: 1,\r\n      previewImageUrl: imageUrl.value\r\n    })\r\n    \r\n    if (res.code === 200) {\r\n      uni.showToast({\r\n        title: '已加入购物车',\r\n        icon: 'success'\r\n      })\r\n      \r\n      setTimeout(() => {\r\n        uni.switchTab({\r\n          url: '/pages/cart/cart'\r\n        })\r\n      }, 1500)\r\n    }\r\n  } catch (error) {\r\n    uni.showToast({\r\n      title: '加入购物车失败',\r\n      icon: 'none'\r\n    })\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.preview-container {\r\n  min-height: 100vh;\r\n  background-color: #F8F8F8;\r\n}\r\n\r\n.preview-section {\r\n  background: #ffffff;\r\n  padding: 40rpx;\r\n  margin-bottom: 20rpx;\r\n  display: flex;\r\n  justify-content: center;\r\n  \r\n  .preview-canvas {\r\n    border: 2rpx solid #E5E5E5;\r\n    border-radius: 20rpx;\r\n  }\r\n}\r\n\r\n.product-section {\r\n  background: #ffffff;\r\n  padding: 40rpx;\r\n  margin-bottom: 20rpx;\r\n  \r\n  .product-selector {\r\n    margin-bottom: 40rpx;\r\n    \r\n    .selector-label {\r\n      display: block;\r\n      font-size: 32rpx;\r\n      font-weight: bold;\r\n      color: #333333;\r\n      margin-bottom: 20rpx;\r\n    }\r\n    \r\n    .picker-view {\r\n      padding: 20rpx;\r\n      background: #F5F5F5;\r\n      border-radius: 10rpx;\r\n      font-size: 28rpx;\r\n      color: #333333;\r\n    }\r\n  }\r\n  \r\n  .spec-selector {\r\n    .spec-item {\r\n      margin-bottom: 30rpx;\r\n      \r\n      &:last-child {\r\n        margin-bottom: 0;\r\n      }\r\n      \r\n      .spec-label {\r\n        display: block;\r\n        font-size: 28rpx;\r\n        font-weight: bold;\r\n        color: #333333;\r\n        margin-bottom: 20rpx;\r\n      }\r\n      \r\n      .spec-options {\r\n        display: flex;\r\n        gap: 20rpx;\r\n        flex-wrap: wrap;\r\n        \r\n        .spec-option {\r\n          padding: 15rpx 30rpx;\r\n          background: #F5F5F5;\r\n          border-radius: 8rpx;\r\n          font-size: 26rpx;\r\n          color: #666666;\r\n          \r\n          &.active {\r\n            background: #007AFF;\r\n            color: #ffffff;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n.action-section {\r\n  position: fixed;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  padding: 30rpx 40rpx;\r\n  background: #ffffff;\r\n  box-shadow: 0 -4rpx 20rpx rgba(0, 0, 0, 0.1);\r\n  \r\n  .add-cart-btn {\r\n    width: 100%;\r\n    height: 88rpx;\r\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n    color: #ffffff;\r\n    border-radius: 44rpx;\r\n    font-size: 32rpx;\r\n    font-weight: bold;\r\n    border: none;\r\n    \r\n    &[disabled] {\r\n      background: #CCCCCC;\r\n    }\r\n  }\r\n}\r\n</style>\r\n\r\n\r\n","import MiniProgramPage from 'D:/code/my-shop-cursor/frontend/pages/preview/preview.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","computed","onLoad","productApi","uni","cartApi"],"mappings":";;;;;;;AA6DA,UAAM,SAASA,cAAG,IAAC,IAAI;AACvB,UAAM,WAAWA,cAAG,IAAC,EAAE;AACvB,UAAM,WAAWA,cAAG,IAAC,EAAE;AACvB,UAAM,kBAAkBA,cAAG,IAAC,IAAI;AAChC,UAAM,gBAAgBA,cAAG,IAAC,EAAE;AAC5B,UAAM,eAAeA,cAAG,IAAC,EAAE;AAC3B,UAAM,cAAcA,cAAG,IAAC,GAAG;AAC3B,UAAM,eAAeA,cAAG,IAAC,GAAG;AAE5B,UAAM,eAAeC,cAAQ,SAAC,MAAM;AAClC,aAAO,gBAAgB,SAAS,cAAc,SAAS,aAAa;AAAA,IACtE,CAAC;AAEDC,kBAAM,OAAC,OAAO,YAAY;AACxB,aAAO,QAAQ,QAAQ;AACvB,eAAS,QAAQ,mBAAmB,QAAQ,YAAY,EAAE;AAC1D,YAAM,aAAc;AAAA,IACtB,CAAC;AAED,UAAM,eAAe,YAAY;AAC/B,UAAI;AACF,cAAM,MAAM,MAAMC,YAAU,WAAC,YAAa;AAC1C,YAAI,IAAI,SAAS,OAAO,IAAI,MAAM;AAChC,mBAAS,QAAQ,IAAI,QAAQ,CAAE;AAC/B,cAAI,SAAS,MAAM,SAAS,GAAG;AAC7B,4BAAgB,QAAQ,SAAS,MAAM,CAAC;AACxC,gBAAI,gBAAgB,MAAM,UAAU,gBAAgB,MAAM,OAAO,SAAS,GAAG;AAC3E,4BAAc,QAAQ,gBAAgB,MAAM,OAAO,CAAC;AAAA,YACrD;AACD,gBAAI,gBAAgB,MAAM,SAAS,gBAAgB,MAAM,MAAM,SAAS,GAAG;AACzE,2BAAa,QAAQ,gBAAgB,MAAM,MAAM,CAAC;AAAA,YACnD;AAAA,UACF;AAAA,QACF;AAAA,MACF,SAAQ,OAAO;AACdC,sBAAAA,MAAA,MAAA,SAAA,mCAAc,UAAU,KAAK;AAAA,MAC9B;AAAA,IACH;AAEA,UAAM,kBAAkB,CAAC,MAAM;AAC7B,sBAAgB,QAAQ,SAAS,MAAM,EAAE,OAAO,KAAK;AACrD,UAAI,gBAAgB,MAAM,UAAU,gBAAgB,MAAM,OAAO,SAAS,GAAG;AAC3E,sBAAc,QAAQ,gBAAgB,MAAM,OAAO,CAAC;AAAA,MACrD;AACD,UAAI,gBAAgB,MAAM,SAAS,gBAAgB,MAAM,MAAM,SAAS,GAAG;AACzE,qBAAa,QAAQ,gBAAgB,MAAM,MAAM,CAAC;AAAA,MACnD;AAAA,IACH;AAEA,UAAM,kBAAkB,YAAY;AAClC,UAAI,CAAC,aAAa;AAAO;AAEzB,UAAI;AACF,cAAM,MAAM,MAAMC,SAAO,QAAC,UAAU;AAAA,UAClC,QAAQ,OAAO;AAAA,UACf,WAAW,gBAAgB,MAAM;AAAA,UACjC,OAAO,cAAc;AAAA,UACrB,MAAM,aAAa;AAAA,UACnB,UAAU;AAAA,UACV,iBAAiB,SAAS;AAAA,QAChC,CAAK;AAED,YAAI,IAAI,SAAS,KAAK;AACpBD,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UACd,CAAO;AAED,qBAAW,MAAM;AACfA,0BAAAA,MAAI,UAAU;AAAA,cACZ,KAAK;AAAA,YACf,CAAS;AAAA,UACF,GAAE,IAAI;AAAA,QACR;AAAA,MACF,SAAQ,OAAO;AACdA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACZ,CAAK;AAAA,MACF;AAAA,IACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC5IA,GAAG,WAAW,eAAe;"}