{"version":3,"file":"request.js","sources":["utils/request.js"],"sourcesContent":["export const BASE_URL = 'http://localhost:8080/api' // 开发环境，生产环境需要修改\r\n\r\nconst request = (options) => {\r\n  return new Promise((resolve, reject) => {\r\n    // 获取token\r\n    const token = uni.getStorageSync('token')\r\n    \r\n    uni.request({\r\n      url: BASE_URL + options.url,\r\n      method: options.method || 'GET',\r\n      data: options.data || {},\r\n      header: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': token ? `Bearer ${token}` : '',\r\n        ...options.header\r\n      },\r\n      success: (res) => {\r\n        if (res.statusCode === 200) {\r\n          // token过期或无效，自动跳转到登录页\r\n          if (res.data.code === 401) {\r\n            uni.removeStorageSync('token')\r\n            uni.reLaunch({\r\n              url: '/pages/login/login'\r\n            })\r\n            reject(res.data)\r\n            return\r\n          }\r\n          // 返回数据，让业务层自行处理成功和失败\r\n          resolve(res.data)\r\n        } else {\r\n          uni.showToast({\r\n            title: '网络错误',\r\n            icon: 'none'\r\n          })\r\n          reject(res)\r\n        }\r\n      },\r\n      fail: (err) => {\r\n        uni.showToast({\r\n          title: '网络错误',\r\n          icon: 'none'\r\n        })\r\n        reject(err)\r\n      }\r\n    })\r\n  })\r\n}\r\n\r\nexport default request\r\n\r\n\r\n"],"names":["uni"],"mappings":";;AAAY,MAAC,WAAW;AAEnB,MAAC,UAAU,CAAC,YAAY;AAC3B,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AAEtC,UAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AAExCA,kBAAAA,MAAI,QAAQ;AAAA,MACV,KAAK,WAAW,QAAQ;AAAA,MACxB,QAAQ,QAAQ,UAAU;AAAA,MAC1B,MAAM,QAAQ,QAAQ,CAAE;AAAA,MACxB,QAAQ;AAAA,QACN,gBAAgB;AAAA,QAChB,iBAAiB,QAAQ,UAAU,KAAK,KAAK;AAAA,QAC7C,GAAG,QAAQ;AAAA,MACZ;AAAA,MACD,SAAS,CAAC,QAAQ;AAChB,YAAI,IAAI,eAAe,KAAK;AAE1B,cAAI,IAAI,KAAK,SAAS,KAAK;AACzBA,0BAAG,MAAC,kBAAkB,OAAO;AAC7BA,0BAAAA,MAAI,SAAS;AAAA,cACX,KAAK;AAAA,YACnB,CAAa;AACD,mBAAO,IAAI,IAAI;AACf;AAAA,UACD;AAED,kBAAQ,IAAI,IAAI;AAAA,QAC1B,OAAe;AACLA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UAClB,CAAW;AACD,iBAAO,GAAG;AAAA,QACX;AAAA,MACF;AAAA,MACD,MAAM,CAAC,QAAQ;AACbA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QAChB,CAAS;AACD,eAAO,GAAG;AAAA,MACX;AAAA,IACP,CAAK;AAAA,EACL,CAAG;AACH;;;"}